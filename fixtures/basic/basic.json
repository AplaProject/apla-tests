{
    "name": "Basic application",
    "data": [
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetTitle($role_notifics$)\nIf(And(#role_id#==1,#ecosystem_id#==1)){\n    DBFind(ecosystems).Ecosystem(1).Count(ecos_count)\n    If(#ecos_count#>1){\n        AddToolButton(Title: $broadcast_send$, Page: notifications_broadcast, Icon: icon-plus)\n    }\n}\nAddToolButton(Title: $send$, Page: notifications_roles_send, Icon: icon-plus)\nIf(GetVar(Search)){\n    SetVar(Where,\"notification->type='2' and recipient->role_name='#Search#' and recipient->role_id='#role_id#'\")\n}.Else{\n    SetVar(Where,\"notification->type='2' and recipient->role_id='#role_id#'\").(Search,)\n}\n\nDBFind(Name: notifications, Source: src_notifications).Limit(20).Columns(\"id,recipient->role_id,recipient->role_name,recipient->image_id,sender->type,sender->member_id,sender->member_name,sender->role_id,sender->role_name,notification->icon,page_name,page_params,date_created,date_closed,date_start_processing,processing_info->member_name,closed\").Custom(_id){\n    If(#closed# == 0){\n        SetVar(style_text,\"text-normal\").(style_link,\"text-primary\")\n    }.Else{\n        SetVar(style_text,\"text-muted\").(style_link,\"text-muted\")\n    }\n    Span(Class: #style_text#, Body: #id#)\n}.Custom(_recipient){\n    LinkPage(Class: #style_link# t5 text-bold, Page: roles_view, PageParams: \"v_role_id=#recipient.role_id#\"){\n        If(#recipient.image_id#>0){\n            Image(Src: Binary().ById(#recipient.image_id#) \"#img_data#\", Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\n            #recipient.role_name#\n        }.Else{\n            Div(){\n                Span(Em(Class: fa icon-settings fa-2x)).Style(margin-right:10px;)\n                Span(#recipient.role_name#)\n            }.Style(display:flex; align-items:center;)\n        }\n    }\n}.Custom(_sender){\n    If(#sender.type#==1){\n        LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#sender.member_id#\"){#sender.member_name#}\n    }\n    If(#sender.type#==2){\n        LinkPage(Class: #style_link# h5 text-bold, Page: roles_view, PageParams: \"v_role_id=#sender.role_id#\"){#sender.role_name#}\n    }\n}.Custom(_icon){\n    Span(Class: fa #notification.icon# fa-2x #style_text#)\n}.Custom(_page){\n    LinkPage(Class: #style_link# t5 text-bold, Page: #page_name#, PageParams: \"notific_id=#id#\"){\n        #page_name#\n    }\n}.Custom(_date){\n    Div(#style_text# t6){DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\")}\n    Div(#style_text# t6){DateTime(DateTime: #date_closed#, Format: \"DD.MM.YYYY HH:MI\")}\n}.Custom(_processing){\n    Div(Class: #style_text# t6){\n        If(#date_start_processing# == NULL){\n            $not_started$\n        }.Else{\n            Span(LangRes(started), mr-sm) #processing_info.member_name# \n            Span(LangRes(at), mr-sm)\n            DateTime(DateTime: #date_start_processing#, Format: \"DD.MM.YYYY HH:MI\")\n        }\n    }\n}.Custom(_status){\n    If(#closed# == 0){\n        Span(Class: #style_text#){\n            If(#date_start_processing# == NULL){\n                LangRes(active)\n            }.Else{\n                LangRes(processing)\n            }\n        }\n    }.Else{\n        Span(Class: #style_text#, Body: LangRes(closed))\n    }\n}.Custom(_actions){\n    Div(text-right){\n        If(#closed# == 0){\n            If(#date_start_processing# == NULL){\n                Button(Class: btn btn-default fa fa-play, Contract: notifications_Process, Params: \"notific_id=#id#\", Page: notifications_list, PageParams: \"type=1\").Alert(Text: $want_start_processing_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n            }.Else{\n                Button(Class: btn btn-default fa fa-trash, Contract: notifications_Close, Params: \"notific_id=#id#\", Page: notifications_list, PageParams: \"type=1\").Alert(Text: $want_close_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n            }\n        }\n    }\n}.Where(#Where#).Order(\"closed ASC, id DESC\")\n\nForm(panel panel-primary){\n    Div(panel-body){\n        Div(row){\n            Div(col-md-12){\n                Div(input-group){\n                    Div(input-group-addon){\n                        LangRes(recipient)\n                    }\n                    Input(Name: Search, Value: #Search#)\n                    Div(input-group-btn){\n                        Button(Class: btn btn-default fa fa-search, Page: notifications_list, PageParams: \"Search=Val(Search),type=1\")\n                    }\n                }\n            }\n        }\n        Div(row){\n            Div(col-md-12){\n                Table(Source: src_notifications, Columns: \"$id$=_id,$icon$=_icon,$recipient$=_recipient,$page_name$=_page,$sender$=_sender,$processing$=_processing,$sent$/$сlosed$=_date,$status$=_status,=_actions\")\n            }\n        }\n        If(GetVar(Search)){\n            Div(row){\n                Div(col-md-12 mt-lg){\n                    Div(text-center){\n                        Button(Body: $view_all$, Class: btn btn-primary, Page: notifications_list, PageParams: \"type=1\")\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_roles",
            "Type": "blocks"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetTitle($single_notifics$)\nIf(And(#role_id#==1,#ecosystem_id#==1)){\n    DBFind(ecosystems).Ecosystem(1).Count(ecos_count)\n    If(#ecos_count#>1){\n        AddToolButton(Title: $broadcast_send$, Page: notifications_broadcast, Icon: icon-plus)\n    }\n}\nAddToolButton(Title: $send$, Page: notifications_single_send, Icon: icon-plus)\nIf(GetVar(Search)){\n    SetVar(Where,\"notification->type='1' and recipient->member_name='#Search#' and recipient->member_id='#key_id#'\")\n}.Else{\n    SetVar(Where,\"notification->type='1' and recipient->member_id='#key_id#'\").(Search,)\n}\n\nDBFind(Name: notifications, Source: src_notifications).Limit(20).Columns(\"id,recipient->member_id,recipient->member_name,recipient->image_id,sender->type,sender->member_id,sender->member_name,sender->role_id,sender->role_name,notification->icon,page_name,page_params,date_created,date_closed,closed\").Custom(custom_id){\n    If(#closed# == 0){\n        SetVar(Name: style_text, Value: \"text-normal\")\n        SetVar(Name: style_link, Value: \"text-primary\")\n    }.Else{\n        SetVar(Name: style_text, Value: \"text-muted\")\n        SetVar(Name: style_link, Value: \"text-muted\")\n    }\n    Span(Class: #style_text#, Body: #id#)\n}.Custom(custom_recipient){\n    LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#recipient.member_id#\"){\n        If(#recipient.image_id#>0){\n            Image(Src: Binary().ById(#recipient.image_id#), Class: img-circle).Style(width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n            Span(#recipient.member_name#)\n        }.Else{\n            Div(){\n                Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n                Span(#recipient.member_name#)\n            }.Style(display:flex; align-items:center;)\n        }\n    }\n}.Custom(custom_sender){\n    If(#sender.type#==1){\n        LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#sender.member_id#\"){\n            Span(Body: #sender.member_name#)\n        }\n    }\n    If(#sender.type#==2){\n        LinkPage(Class: #style_link# h5 text-bold, Page: roles_view, PageParams: \"v_role_id=#sender.role_id#\"){\n            Span(Body: #sender.role_name#)\n        }\n    }\n}.Custom(custom_icon){\n    Em(Class: fa #notification.icon# fa-2x #style_text#)\n}.Custom(custom_page){\n    LinkPage(Class: #style_link# h5 text-bold, Page: #page_name#, PageParams: \"notific_id=#id#\"){\n        Span(Body: #page_name#)\n    }\n}.Custom(custom_date){\n    Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\"))\n    Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_closed#, Format: \"DD.MM.YYYY HH:MI\"))\n}.Custom(custom_status){\n    If(#closed# == 0){\n        Span(Class: #style_text#, Body: LangRes(active))\n    }.Else{\n        Span(Class: #style_text#, Body: LangRes(сlosed))\n    }\n}.Custom(actions){\n    Div(pull-right){\n        If(#closed# == 0){\n            Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, Contract: notifications_Close, Params: \"notific_id=#id#\", Page: notifications_list).Alert(Text: $want_close_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n        }\n    }\n}.Where(#Where#).Order(\"closed ASC, id DESC\")\n\nForm(panel panel-primary){\n    Div(panel-body){\n        Div(row){\n            Div(col-md-12){\n                Div(input-group){\n                    Div(input-group-addon){\n                        LangRes(recipient)\n                    }\n                    Input(Name: Search, Value: #Search#)\n                    Div(input-group-btn){\n                        Button(Class: btn btn-default fa fa-search, Page: notifications_list, PageParams: \"Search=Val(Search)\")\n                    }\n                }\n            }\n        }\n        Div(row){\n            Div(col-md-12){\n                Table(Source: src_notifications, Columns: \"$id$=custom_id,$icon$=custom_icon,$recipient$=custom_recipient,$page_name$=custom_page,$sender$=custom_sender,$sent$/$сlosed$=custom_date,$status$=custom_status,=actions\")\n            }\n        }\n        If(GetVar(Search)){\n            Div(row){\n                Div(col-md-12 mt-lg){\n                    Div(text-center){\n                        Button(Body: $view_all$, Class: btn btn-primary, Page: notifications_list)\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_single",
            "Type": "blocks"
        },
        {
            "Conditions": "ContractAccess(\"@1EditMenu\")",
            "Value": "MenuItem(Title:Wallet, Page:profile_view, Icon:\"icon-wallet\")\nMenuItem(Title:Notifications, Page:notifications_list, Icon:\"icon-flag\")\nMenuItem(Title:Membership, Page:members_list, Icon:\"fa icon-people\")\nMenuGroup(Title:Admin, Icon:\"icon-arrow-right\"){\n\tMenuItem(Title:Roles, Page:roles_list, Icon:\"fa fa-list-ul\")\n\tMenuItem(Title:Voting, Page:voting_list, Icon:\"fa fa-edit\")\n}",
            "Name": "default_menu",
            "Type": "menu"
        },
        {
            "Name": "votings",
            "Columns": "[{\"name\":\"flags\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"voting\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"creator\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"deleted\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"optional\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"progress\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"date_ended\",\"type\":\"datetime\",\"conditions\":\"true\"},{\"name\":\"date_started\",\"type\":\"datetime\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}",
            "Type": "tables"
        },
        {
            "Name": "votings_participants",
            "Columns": "[{\"name\":\"member\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"decision\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"voting_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"decision_date\",\"type\":\"datetime\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"voting_Invite\\\")\", \"update\": \"ContractAccess(\\\"voting_RejectDecision\\\",\\\"voting_AcceptDecision\\\",\\\"voting_AcceptCandidates\\\")\", \"new_column\": \"true\"}",
            "Type": "tables"
        },
        {
            "Name": "votings_subject",
            "Columns": "[{\"name\":\"subject\",\"type\":\"json\",\"conditions\":\"true\"},{\"name\":\"voting_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"number_accept\",\"type\":\"number\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"true\", \"update\": \"true\", \"new_column\": \"true\"}",
            "Type": "tables"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "single,multiple",
            "Name": "notification_closure",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "fa-bell,fa-comment,fa-envelope,fa-bookmark,fa-check,fa-exclamation-triangle,fa-info-circle",
            "Name": "notification_icon",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "notification_sender_member,notification_sender_role",
            "Name": "notification_sender",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "single,role",
            "Name": "notification_type",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "assigned_role,elective_role,system_role",
            "Name": "roles_types",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "assigned_role,elective_role",
            "Name": "roles_types_selection",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "type_voting_custom,type_voting_system",
            "Name": "type_voting",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "candidate_requests,candidate_manual,document,database_write,contract_run",
            "Name": "type_voting_decisions",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "everybody,manual_add,role",
            "Name": "type_voting_participants",
            "Type": "app_params"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "If(#ecosystem_id#==1){\n\tSetTitle(\"\")\n}.Else{\n\tDiv(content-wrapper){\n\t\tDiv(panel panel-primary){\n\t\t\tDiv(list-group-item text-center){\n\t\t\t\tP(Class: h3 m0 text-bold, Body: Congratulations! You created your own ecosystem.)\n\t\t\t}\n\t\t\tDiv(list-group-item){\n\t\t\t\tSpan(Class: h3, Body: \"You as Founder hold a complete set of rights for controlling the ecosystem – creating and editing applications, modifying ecosystem parameters, etc. \")\n\t\t\t\tSpan(Class: h3, Body: \"To get started, you can download the finished applications from the\")\n\t\t\t\tSpan(Class: h3 text-primary, Body: \" https://github.com/GenesisKernel/apps \")\n\t\t\t\tSpan(Class: h3, Body: \"and install them using the Import service. \")\n\t\t\t\tSpan(Class: h3, Body: \"The Strong(basic.json) contains applications for managing roles, creating notifications and votings. \")\n\t\t\t\tSpan(Class: h3, Body: \"Or you can create your own apps using the tools in the Admin tab. \")\n\t\t\t\tSpan(Class: h3, Body: \"Documentation \")\n\t\t\t\tSpan(Class: h3 text-primary, Body: \"https://genesiskernel.readthedocs.io\")\n\t\t\t}\n\t\t\tDiv(panel-footer text-right clearfix){\n\t\t\t\tDiv(pull-left){\n\t\t\t\t\tButton(Body: Ecosystem parameters, Class: btn btn-default, Page: params_list)\n\t\t\t\t}.Style(margin-right: 20px;)\n\t\t\t\tDiv(pull-left){\n\t\t\t\t\tButton(Body: Dashboard, Class: btn btn-default, Page: admin_dashboard)          \n\t\t\t\t}\n\t\t\t\tButton(Body: Import, Class: btn btn-primary, Page: import_upload)\n\t\t\t}\n\t\t}\n\t}\n}",
            "Name": "default_page",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    SetTitle($membership$)\n\n    If(GetVar(Search)){\n        SetVar(Where,\"id='#Search#'\")\n    }.Else{\n        SetVar(Where,\"id!=0\").(Search,)\n    } \n    \n    DBFind(Name: keys, Source: src_member).Columns(\"id\").Custom(custom_id){\n        SetVar(Name: style_text, Value: \"text-normal\")\n        SetVar(Name: style_link, Value: \"text-primary\")\n        Span(Class: h5, Body: #id#)\n        SetVar(m_id, 0)\n        DBFind(Name: members).Where(\"id=#id#\").Vars(m)\n        If(Or(#m_id#>0,#m_id#<0)){\n            SetVar(image_id, #m_image_id#)\n            SetVar(member_name, #m_member_name#)\n        }.Else{\n            SetVar(image_id, 0)\n            SetVar(member_name, \"\")\n        }\n    }.Custom(custom_member_id){\n        Button(Body: Address(#id#), Class: btn btn-link, Page: tokens_transfer, PageParams: \"v_id=#id#\").Popup(Header: $tokens_transfer$, Width: \"30\")\n    }.Custom(custom_username){\n        LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#id#\"){\n            If(#image_id#>0){\n                Image(Src: Binary().ById(#image_id#), Class: img-circle).Style(height: 30px;width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n                Span(#member_name#)\n            }.Else{\n                Div(){\n                    Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n                    Span(#member_name#)\n                }.Style(display:flex; align-items:center;)\n            }\n        }\n    }.Where(#Where#).Order(\"id\")\n    \n    Form(panel panel-primary){\n        Div(panel-body){\n            Div(row){\n                Div(col-md-12){\n                    Div(input-group){\n                        Div(input-group-addon){\n                            LangRes(id)\n                        }\n                        Input(Name: Search, Value: #Search#)\n                        Div(input-group-btn){\n                            Button(Class: btn btn-default fa fa-search, Page: members_list, PageParams: \"Search=Val(Search)\")\n                        }\n                    }\n                }\n            }\n            Div(row){\n                Div(col-md-12){\n                    Table(Source: src_member, Columns: \"$name$=custom_username,$id$=custom_id,$wallet_address$=custom_member_id\")\n                }\n            }\n            If(GetVar(Search)){\n                Div(row){\n                    Div(col-md-12 mt-lg){\n                        Div(text-center){\n                            Button(Body: $view_all$, Class: btn btn-primary, Page: members_list)\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "members_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "DBFind(applications).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\nSetTitle($notifications_broadcast$)\nDBFind(ecosystems).Ecosystem(1).Count(ecos_count)\n\nDiv(content-wrapper){\n    Div(breadcrumb){\n        LinkPage($notifications$, notifications_list)\n        Span(/,mh)\n        Span($broadcast_send$,text-muted)\n    }\n\n    Div(row){\n        Div(col-sm-8 col-sm-offset-2){\n            If(And(#role_id#==1,#ecosystem_id#==1,#ecos_count#>1)){\n                DBFind(roles,src_roles).Ecosystem(2).Where(\"role_type=3\").Columns(\"id,role_name\")\n                Form(panel panel-primary){\n                    Div(panel-body){\n                        Div(row mt){\n                            Div(col-sm-4 mt text-right){\n                                LangRes(header)\n                            }\n                            Div(col-sm-8){\n                                Input(Name: Header, Type: textarea)\n                            }\n                        }\n                        Div(row mt){\n                            Div(col-sm-4 mt text-right){\n                                LangRes(body_text)\n                            }\n                            Div(col-sm-8){\n                                Input(Name: Body, Type: textarea)\n                            }\n                        }\n                        Div(row mt){\n                            Div(col-sm-4 mt text-right){\n                                LangRes(recipient)\n                            }\n                            Div(col-sm-8){\n                                Select(Name: RoleId, Source: src_roles, NameColumn: role_name, ValueColumn: id)\n                            }\n                        }\n                    }\n                    Div(panel-footer text-left){\n                        Button(Body: LangRes(cancel), Class: btn btn-default, Page: notifications_list)\n                        Button(Body: LangRes(send), Class: btn btn-primary pull-right, Contract: @1NotificationsBroadcast, Params: \"notific_id=#notific_id#\", Page: notifications_list)\n                    }\n                }\n            }.Else{\n                Div(col-sm-12 alert alert-warning text-center){\n                    If(#role_id#!=1){\n                        LangRes(only_admin_action)\n                    }\n                    If(#ecosystem_id#!=1){\n                        LangRes(only_first_ecosystem_action)\n                    }\n                    If(#ecos_count#==1){\n                        LangRes(other_ecosystems_not_found)\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_broadcast",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(Or(#type#==0,#type#==1)){\n    }.Else{\n        SetVar(Name: type, Value: 0)\n    }\n    Div(row){\n        Div(col-md-12){\n            Div(btn-group){\n                If(#type#==0){\n                    Span(Button(Body: Em(Class: fa fa-bell-o) $single_notifics$, Page: notifications_list, PageParams: \"type=0\", Class: btn bg-gray-lighter)).Style(margin-left:5px;)\n                }.Else{\n                    Span(Button(Body: Em(Class: fa fa-bell-o) $single_notifics$, Page: notifications_list, PageParams: \"type=0\", Class: btn bg-gray)).Style(margin-left:5px;)\n                }\n                If(#type#==1){\n                    Span(Button(Body: Em(Class: fa fa-bullhorn) $role_notifics$, Page: notifications_list, PageParams: \"type=1\", Class: btn bg-gray-lighter)).Style(margin-left:5px;)\n                }.Else{\n                    Span(Button(Body: Em(Class: fa fa-bullhorn) $role_notifics$, Page: notifications_list, PageParams: \"type=1\", Class: btn bg-gray)).Style(margin-left:5px;)\n                }\n            }\n        }\n    }\n    Div(row){\n        Div(col-md-12){\n            Div(btn-group){\n                If(#type#==0){\n                    Include(notifications_single)\n                }\n                If(#type#==1){\n                    Include(notifications_roles)\n                }\n            }\n        }\n    }\n}\n",
            "Name": "notifications_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(app)\n\n    SetTitle($role_notifics$)\n    Div(breadcrumb){\n        LinkPage($role_notifics$, notifications_list,, \"type=1\")\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\n        Span(Class: text-muted, Body: $send$)\n    }\n\n    Div(row){\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\n            Form(panel panel-primary){\n                Div(panel-heading){LangRes(role_notifics)}\n                Div(panel-body){\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(recipient))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                DBFind(Name: roles, Source: source_roles).Columns(\"id,role_name\").Where(\"deleted=0\")\n                                Select(Name: rid, Source: source_roles, NameColumn: role_name, ValueColumn: id)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(closure_type))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mc-sm text-left){\n                                AppParam(App:#app_id#, Name: notification_closure, Source: src_closure_type)\n                                Select(Name: closure_type, Source: src_closure_type, NameColumn: name, ValueColumn: id)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(sender))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mc-sm text-left){\n                                AppParam(App:#app_id#, Name: notification_sender, Source: src_sender)\n                                Select(Name: sender, Source: src_sender, NameColumn: name, ValueColumn: id)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(icon))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                AppParam(App:#app_id#, Name: notification_icon, Source: src_icon)\n                                Select(Name: icon_name, Source: src_icon, NameColumn: name, ValueColumn: name)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(header))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                Input(Name: text_header, Value: \"Header text\").Validate(minLength:3, maxLength:255)\n                                InputErr(Name: text_header, minLength: $validate_notification$, maxLength: $validate_role_name$)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(body_text))\n                                }\n                            }\n                            Div(col-md-9 mc-sm text-left){\n                                Input(Name: text_body, Value: \"Body text\")\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(page_name))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                Input(Name: page_name, Value: \"notifications_testpage\").Validate(minLength:3, maxLength:255)\n                                InputErr(Name: page_name, minLength: $validate_notification$, maxLength: $validate_role_name$)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(params))\n                                }\n                            }\n                            Div(col-md-9 mc-sm text-left){\n                                Input(Name: params_map, Value: `{\"param_int\":\"10\",\"param_str\":\"my_string\"}`)\n                            }\n                        }\n                    }\n                }\n                Div(panel-footer text-right){\n                    Button(Body: LangRes(back), Class: btn btn-default, Page: notifications_list, PageParams: \"type=1\")\n                    Button(Body: LangRes(send), Class: btn btn-primary, Page: notifications_list, PageParams: \"type=1\", Contract: notifications_Send)\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_roles_send",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "DBFind(applications).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\nSetTitle($notifications_view$)\n\nSetVar(type,0).(header,).(body,)\nDiv(content-wrapper){\n\n    If(#notific_id#>0){\n        DBFind(notifications).Columns(\"id,sender->type,notification->header,notification->body,date_start_processing,closed\").Where(\"id=#notific_id#\").Vars(note)\n        SetVar(type,#note_sender_type#)\n        SetVar(header,#note_notification_header#)\n        SetVar(body,#note_notification_body#)\n\n\n        Div(row){\n            Div(col-md-6 col-md-offset-3){\n                Form(panel panel-primary){\n                    Div(panel-heading text-center){\n                        #header#\n                    }\n                    Div(panel-body){\n                        #body#\n                    }\n                    Div(panel-footer text-right){\n                        If(#type# == 1){\n                            If(#note_closed# == 0){\n                                Button(Body: LangRes(understand), Class: btn btn-primary, Contract: notifications_Close, Params: \"notific_id=#notific_id#\", Page: default_page)\n                            }\n                        }.ElseIf(#type# == 2){\n                            If(#note_closed#==0){\n                                If(#note_date_start_processing#==\"\"){\n                                    Button(Body: LangRes(understand), Class: btn btn-primary, Contract: notifications_Process, Params: \"notific_id=#notific_id#\", Page: notifications_show)\n                                }.Else{\n                                    Button(Body: LangRes(close), Class: btn btn-primary, Contract: notifications_Close, Params: \"notific_id=#notific_id#\", Page: default_page)\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            LangRes(attention)\n        }\n    }\n}",
            "Name": "notifications_show",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(app)\n\n    SetTitle($single_notifics$)\n    Div(breadcrumb){\n        LinkPage($single_notifics$, notifications_list)\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\n        Span(Class: text-muted, Body: $send$)\n    }\n\n    Div(row){\n        Div(col-md-6 col-md-offset-3){\n            Form(panel panel-primary){\n                Div(panel-heading){LangRes(single_notifics)}\n                Div(panel-body){\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(recipient)).(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 text-left){\n                                DBFind(keys,src_keys).Columns(\"id\").Custom(_name){\n                                    DBFind(members).Columns(\"id,member_name\").Where(\"id=#id#\").Vars(m)\n                                    Address(#id#)\n                                    If(Or(#m_id#>0,#m_id#<0)){\n                                        \" (#m_member_name#)\"\n                                    }\n                                }\n                                Select(Name: member_id, Source: src_keys, NameColumn: _name, ValueColumn: id)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(sender)).(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 text-left){\n                                AppParam(App:#app_id#, Name: notification_sender, Source: src_sender)\n                                Select(Name: sender, Source: src_sender, NameColumn: name, ValueColumn: id)\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(icon)).(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                AppParam(App:#app_id#, Name: notification_icon, Source: src_icon)\n                                Select(Name: icon_name, Source: src_icon, NameColumn: name, ValueColumn: name)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(header)).(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                Input(Name: text_header, Value: \"Header text\").Validate(minLength:3, maxLength:255)\n                                InputErr(Name: text_header, minLength: $validate_notification$, maxLength: $validate_role_name$)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(body_text))\n                                }\n                            }\n                            Div(col-md-9 text-left){\n                                Input(Name: text_body, Value: \"Body text\")\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(page_name)).(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                Input(Name: page_name, Value: \"notifications_testpage\").Validate(minLength:3, maxLength:255)\n                                InputErr(Name: page_name, minLength: $validate_notification$, maxLength: $validate_role_name$)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(params))\n                                }\n                            }\n                            Div(col-md-9 text-left){\n                                Input(Name: params_map, Value: `{\"param_int\":\"10\",\"param_str\":\"my_string\"}`)\n                            }\n                        }\n                    }\n                }\n                Div(panel-footer text-right){\n                    Button(Body: LangRes(back), Class: btn btn-default, Page: notifications_list)\n                    Button(Body: LangRes(send), Class: btn btn-primary, Page: notifications_list, Contract: notifications_Send)\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_single_send",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(app)\n    SetTitle($test_page$)\n\n    If(#notific_id# > 0){\n        DBFind(Name: notifications, Source: src_notifications).Columns(\"id,notification->type,notification->header,page_params->param_int,page_params->param_str,date_start_processing,closed\").Where(\"id=#notific_id#\").Vars(prefix)\n        SetVar(Name: notific_type, Value: #prefix_notification_type#)\n        SetVar(Name: notific_header, Value: #prefix_notification_header#)\n        SetVar(Name: notific_val_int, Value: #prefix_page_params_param_int#)\n        SetVar(Name: notific_val_str, Value: #prefix_page_params_param_str#)\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n        SetVar(Name: notific_id, Value: \"0\")\n        SetVar(Name: notific_type, Value: \"0\")\n        SetVar(Name: notific_header, Value: \"null\")\n        SetVar(Name: notific_val_int, Value: \"null\")\n        SetVar(Name: notific_val_str, Value: \"null\")\n    }\n\n    Div(row){\n        Div(col-md-6 col-md-offset-3){\n            Form(panel panel-default){\n                Div(panel-body){\n                    Div(list-group-item text-center){\n                        Span(Class: h3, Body: #notific_header#)\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-6 mt-sm text-right){\n                                Span(Class: h4, Body: LangRes(id))\n                            }\n                            Div(col-md-6 mt-sm text-left){\n                                Span(Class: h4, Body: #notific_id#)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-6 mt-sm text-right){\n                                Span(Class: h4, Body: LangRes(type))\n                            }\n                            Div(col-md-6 mt-sm text-left){\n                                If(#notific_type# > 0){\n                                    Span(Class: h4, Body: AppParam(App:#app_id#, Name: notification_type, Index: #notific_type#))\n                                }.Else{\n                                    Span(Class: h4, Body: #notific_type#)\n                                }\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Div(row){\n                            Div(col-md-6 mt-sm text-right){\n                                Span(Class: h4, Body: LangRes(value_number))\n                            }\n                            Div(col-md-6 mt-sm text-left){\n                                Span(Class: h4, Body: #notific_val_int#)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-6 mt-sm text-right){\n                                Span(Class: h4, Body: LangRes(value_string))\n                            }\n                            Div(col-md-6 mt-sm text-left){\n                                Span(Class: h4, Body: #notific_val_str#)\n                            }\n                        }\n                    }\n                }\n                If(#notific_type# == 1){\n                    If(#prefix_closed# == 0){\n                        Div(panel-footer text-right){\n                            Button(Body: LangRes(close), Class: btn btn-primary, Contract: notifications_Close, Params: \"notific_id=#notific_id#\", Page: notifications_list).Alert(Text: $want_close_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                        }\n                    }\n                }\n                If(#notific_type# == 2){\n                    If(#prefix_closed# == 0){\n                        Div(panel-footer text-right){\n                            If(#prefix_date_start_processing# == \"\"){\n                                Button(Body: LangRes(begin), Class: btn btn-primary, Contract: notifications_Process, Params: \"notific_id=#notific_id#\", Page: notifications_list, PageParams: \"type=1\").Alert(Text: $want_start_processing_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                            }.Else{\n                                Button(Body: LangRes(close), Class: btn btn-primary, Contract: notifications_Close, Params: \"notific_id=#notific_id#\", Page: notifications_list, PageParams: \"type=1\").Alert(Text: $want_close_notification$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_testpage",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Form(){\n    Div(form-group){\n        Label($avatar$)\n        Input(Name: member_image, Type: file)\n    }\n    Div(form-group){\n        Button(Body: LangRes(save), Class: btn btn-primary pull-right, Contract: ProfileEditAvatar, Page: profile_edit, PageParams:\"v_member_id=#v_member_id#\")\n        Button(Body: LangRes(close), Class: btn btn-default pull-right, Page: profile_edit, PageParams:\"v_member_id=#v_member_id#\")\n    }\n}",
            "Name": "profile_avatar_edit",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    SetTitle($editing_profile$)\n    Div(breadcrumb){\n        LinkPage($user_info$, profile_view)\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\n        Span(Class: text-muted, Body: $editing_profile$)\n    }\n    \n    If(Or(#v_member_id#>0,#v_member_id#<0)){\n        DBFind(Name: members, Source: src_member).Columns(\"id,member_name,image_id,member_info->information\").Where(\"id=#v_member_id#\").Vars(prefix)\n    }.Else{\n        DBFind(Name: members, Source: src_member).Columns(\"id,member_name,image_id,member_info->information\").Where(\"id=#key_id#\").Vars(prefix)\n    }\n    \n    Div(row){\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\n            Form(panel panel-primary){\n                Div(panel-heading, Body: LangRes(editing_profile))\n                Div(panel-body){\n                    Div(row){\n                        Div(col-md-5 mt-lg text-center){\n                            Button(Class: btn btn-link, Page: profile_avatar_edit, PageParams: \"v_member_id=#key_id#\"){\n                                If(#prefix_image_id#>0){\n                                    Image(Src: Binary().ById(#prefix_image_id#), Class: img-thumbnail).Style(width: 140px; border: 1px solid #5A5D63;)\n                                }.Else{\n                                    Span(Class: fa icon-user fa-5x).Style(margin-top:20px;)\n                                }\n                            }.Popup(Header: $editing_profile$, Width: 30)\n                        }\n                        Div(col-md-7 mc-sm text-left){\n                            Div(form-group){\n                                Label(){\n                                    Span(Body: LangRes(member_name))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                If(Or(#prefix_id#>0,#prefix_id#<0)){\n                                    Input(Name: member_name, Value: #prefix_member_name#, Disabled: true)\n                                }.Else{\n                                    Input(Name: member_name).Validate(minLength:5, maxLength:20)\n                                    InputErr(Name: member_name, minLength: $validate_member_name$, maxLength: $validate_member_name$)\n                                }\n                            }\n                            Div(form-group){\n                                If(GetVar(prefix_member_info_information)){\n                                    Label(){\n                                        Span(Body: LangRes(information))\n                                    }\n                                    Input(Name: information, Type: textarea, Value: #prefix_member_info_information#)\n                                }.Else{\n                                    Label(){\n                                        Span(Body: LangRes(information))\n                                    }\n                                    Input(Name: information, Type: textarea)\n                                }\n                            }\n                        }\n                    }\n                }\n                Div(panel-footer clearfix){\n                    Button(Body: LangRes(save), Class: btn btn-primary pull-right, Page: profile_view, PageParams: \"v_member_id=#v_member_id#\", Contract: Profile_Edit).Alert(Text: $want_save_changes$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                    Button(Body: LangRes(back), Class: btn btn-default pull-right, Page: profile_view, PageParams: \"v_member_id=#v_member_id#\")\n                }\n            }\n        }\n    }\n}",
            "Name": "profile_edit",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(Or(#v_member_id#>0,#v_member_id#<0)){\n    }.Else{\n        SetVar(Name: v_member_id, Value: #key_id#)\n    }\n    DBFind(Name: members, Source: src_member).Columns(\"id,image_id,member_name,member_info->information\").Where(\"id=#v_member_id#\").Vars(prefix)\n    DBFind(Name: keys, Source: src_keys).Where(\"id=#v_member_id#\").Vars(tokens)\n    \n    If(Or(#prefix_id#>0,#prefix_id#<0)){\n    }.Else{\n        SetVar(Name: prefix_member_name, Value: \"\")\n    }\n    \n    Div(row){\n        Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\n            Form(panel panel-primary){\n                Div(list-group-item){\n                    P(Class: text-center text-bold h4 m0, Body: LangRes(user_info))\n                    Div(panel-body){\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-12 mt-sm text-center){\n                                    If(Or(#prefix_id#>0,#prefix_id#<0)){\n                                        If(#prefix_id# == #key_id#){\n                                            Button(Class: btn btn-link, Page: profile_edit, PageParams: \"v_member_id=#key_id#\"){\n                                                If(#prefix_image_id#>0){\n                                                    Image(Src: Binary().ById(#prefix_image_id#), Class: img-thumbnail).Style(width: 120px; border: 1px solid #5A5D63;)\n                                                }.Else{\n                                                    Span(Class: fa icon-user fa-5x text-primary)\n                                                }\n                                                Div(m0 h4 text-bold){#prefix_member_name#}\n                                            }\n                                        }.Else{\n                                            If(#prefix_image_id#>0){\n                                                Image(Src: Binary().ById(#prefix_image_id#), Class: img-thumbnail).Style(width: 120px; border: 1px solid #5A5D63;)\n                                            }.Else{\n                                                Span(Class: fa icon-user fa-5x)\n                                            }\n                                            Div(m0 h4 text-bold){#prefix_member_name#}\n                                        }\n                                        Div(Class: h5 text-muted m0, Body: #prefix_member_info_information#)\n                                    }.Else{\n                                        Div(text-muted m0 h5, Body: LangRes(wallet_address))\n                                        Div(Class: h5, Body: Address(#key_id#))\n                                        Button(Class: btn btn-link, Page: profile_edit){\n                                            Div(Class: h5 m0, Body: LangRes(editing_profile))\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        Div(list-group-item text-center){\n                            Div(text-muted m0 h5, Body: LangRes(roles))\n                            DBFind(Name: roles_participants, Source: src_check).Columns(\"id\").Where(\"member->member_id='#v_member_id#' and deleted=0\").Vars(check)\n                            If(#check_id#>0){\n                                DBFind(Name: roles_participants, Source: src_roles).Columns(\"role->id,role->name\").Where(\"member->member_id='#v_member_id#' and deleted=0\").Order(\"id\")\n                                ForList(src_roles){\n                                    Span(){\n                                        LinkPage(Page: roles_view, PageParams: \"v_role_id=#role.id#\"){\n                                            Span(Class: h5, Body: \"#role.name#\")\n                                        }\n                                    }.Style(margin-right: 6px; margin-left: 6px;)\n                                }\n                            }.Else{\n                                Span(LangRes(no))\n                            }\n                            If(#v_member_id# == #key_id#){\n                                SetVar(founder_account, EcosysParam(\"founder_account\"))\n                                If(#founder_account# != #key_id#){\n                                Div(){\n                                    Button(Class: btn btn-link, Page: roles_request, Body: LangRes(request)).Popup(Header: $request$, Width: \"30\")\n                                }\n                            }\n                        }\n                    }\n                }\n                If(#prefix_id# == #key_id#){\n                    Div(list-group-item){\n                        P(Class: text-center text-bold h4 m0, Body: LangRes(tokens_transfer))\n                        Div(panel-body){\n                            Div(form-group){\n                                Div(row){\n                                    Div(col-md-12 mc-sm text-center){\n                                        Div(text-muted m0 h5, Body: LangRes(tokens))\n                                        Span(Class: h5 text-bold, Body: Money(#tokens_amount#) APL)\n                                    }\n                                }\n                                Div(row){\n                                    Div(col-md-12 mt-lg text-center){\n                                        Div(text-muted m0 h5, Body: LangRes(wallet_address))\n                                        Span(Class: h5, Body: Address(#prefix_id#))\n                                    }\n                                }\n                            }\n                            Div(list-group-item text-center){\n                                Div(row){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Span(Class: h6 text-bold, Body: LangRes(recipient))\n                                    }\n                                    Div(col-md-9 mb-sm text-left){\n                                        Input(Name: Recipient_Account, Placeholder: \"xxxx-xxxx-xxxx-xxxx-xxxx\")\n                                    }\n                                }\n                                Div(row){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Span(Class: h6 text-bold, Body: LangRes(amount))\n                                    }\n                                    Div(col-md-9 mc-sm text-left){\n                                        Input(Name: Amount, Type: Number)\n                                    }\n                                }\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-12 mc-sm){\n                                Button(Body: LangRes(send), Class: btn btn-default pull-right, Page: profile_view, Contract: SendTokens).Alert(Text: $want_send_tokens$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "profile_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    DBFind(applications,src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\n    If(#v_role_id#>0){\n        DBFind(roles,src_roles).Columns(\"id,role_name,role_type,roles_access->rids,creator->member_id\").Where(\"id=#v_role_id#\").Vars(prefix)\n\n        If(#prefix_creator_member_id#==#key_id#){\n            SetVar(manager_id,1)\n        }.ElseIf(#prefix_roles_access_rids#!=\"\"){\n            DBFind(roles).Columns(\"id\").Where(\"id in (#prefix_roles_access_rids#) and id=#role_id#\").Vars(manager)\n        }.Else{\n            SetVar(manager_id,0)\n        }\n        SetTitle($assign$)\n        Div(breadcrumb){\n            LinkPage($roles$, roles_list)\n            Span(/,mh-sm)\n            LinkPage(#prefix_role_name#, roles_view,, \"v_role_id=#v_role_id#\")\n            Span(/,mh-sm).($assign$,text-muted)\n        }\n\n        Div(row){\n            Div(col-md-6 col-md-offset-3){\n                Form(panel panel-primary){\n                    Div(panel-heading){LangRes(assign)}\n                    Div(panel-body){\n                        Div(list-group-item){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(role))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Type: hidden, Name: rid, Value: #prefix_id#)\n                                    SetVar(Name: var_prefix_role_name, Value: LangRes(#prefix_role_name#))\n                                    Input(Name: input_prefix_role_name, Value: #var_prefix_role_name#, Disabled: true)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        LangRes(type) Span(*,text-danger)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    SetVar(Name: var_prefix_role_type, Value: AppParam(App:#application_id#, Name: roles_types, Index: #prefix_role_type#))\n                                    Input(Name: input_prefix_role_type, Value: #var_prefix_role_type#, Disabled: true)\n                                    If(#manager_id#==0){\n                                        P(Class: m0 text-danger h6, Body: LangRes(appointment_impossible))\n                                    }\n                                }\n                            }\n                            If(#manager_id#>0){\n                                Div(row){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(member)).(Class: text-danger, Body:*)\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        DBFind(keys,src_keys).Columns(\"id\").Custom(_name){\n\t\t\t\t\t\t\t\t\t\t\tSetVar(m_id, 0)\n                                            DBFind(members).Columns(\"id,member_name\").Where(\"id=#id#\").Vars(m)\n                                            Address(#id#)\n                                            If(Or(#m_id#>0,#m_id#<0)){\n                                                \" (#m_member_name#)\"\n                                            }\n                                        }\n                                        Select(Name: member_id, Source: src_keys, NameColumn: _name, ValueColumn: id)\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-right){\n                        Button(Body: LangRes(back), Class: btn btn-default, Page: roles_view, PageParams: \"v_role_id=#v_role_id#\")\n                        If(#manager_id#>0){\n                            Button(Body: LangRes(assign), Class: btn btn-primary, Page: roles_view, PageParams: \"v_role_id=#v_role_id#\", Contract: Roles_Assign, Params: \"member_id=Val(member_id)\").Alert(Text: $want_assign_member_to_role$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "roles_assign",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "DBFind(applications).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\nDBFind(roles, src_roles).Columns(\"role_name,id\").Where(\"deleted=0\").Order(id)\n\nIf(GetVar(role_name)){}.Else{SetVar(role_name,)}\nIf(GetVar(role_type)){}.Else{SetVar(role_type,1)}\n\nIf(GetVar(rid)){\n    DBFind(roles).Where(\"id=#rid#\").Columns(\"roles_access->rids,id,role_type,role_name\").Vars(rid)\n    SetVar(title,$edit_role$).(role_type,\"AppParam(App:#application_id#, Name: roles_types, Index: #rid_role_type#)\")\n\n    If(#rid_roles_access_rids#!=\"\"){\n        DBFind(roles,src_roles_access).Columns(\"id,role_name\").Where(\"id in (#rid_roles_access_rids#)\").Order(role_name)\n    }\n    DBFind(roles,src_roles).Columns(\"id,role_name\").Where(\"deleted=0\").Order(id)\n    Data(form, \"Name,Res,Type,Src,Val\"){\n        role_name,name,text,,#role_name#\n        roles_types,type,app_param,,#rid_role_type#\n        roles_managers,roles_managers,rids,src_roles,\n    }\n}.Else{\n    AppParam(App:#application_id#, Name: roles_types_selection, Source: app_roles_types)\n    SetVar(rid,0).(title,$new_role$)\n    Data(form, \"Name,Res,Type,Req,Src,Val\"){\n        role_name,name,input,*,\"\",#role_name#\n        role_type,type,select,*,app_roles_types,#role_type#\n    }\n}\nSetTitle(#title#)\nIf(And(#role_name#==\"\",#rid_id#>0)){\n    SetVar(role_name,#rid_role_name#).(role_type,#rid_role_type#)\n}\n\nDiv(content-wrapper){\n    Div(breadcrumb){\n        LinkPage($roles$, roles_list)\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\n        Span(Class: text-muted, Body: #title#)\n    }\n    Div(container){\n        Div(row){\n            Div(col-md-8 col-md-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-heading){#title#}\n                    Div(panel-body){\n                        ForList(form){\n                            Div(row form-group){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(For:#Name#){\n                                        LangRes(#Res#)\n                                        If(#Req#==\"*\"){\n                                            Span(*,text-danger)\n                                        }\n                                    }\n                                }\n                                Div(col-md-9 text-left){\n                                    If(#Type#==input){\n                                        Input(Name: #Name#, Value:#Val#).Validate(minLength:3, maxLength:30)\n                                        InputErr(Name: #Name#, minLength: $validate_role_name$, maxLength: $validate_role_name$)\n                                    }.ElseIf(#Type#==text){\n                                        Div(text-muted mt-sm){#Val#}\n                                    }.ElseIf(#Type#==app_param){\n                                        Div(text-muted mt-sm){\n                                            AppParam(App:#application_id#, Name: #Name#, Index: #Val#)\n                                        }\n                                    }.ElseIf(#Type#==select){\n                                        Select(Name: #Name#, Source: #Src#, NameColumn: name, ValueColumn: id, Value:#Val#)\n                                    }.ElseIf(#Type#==rids){\n                                        Div(input-group mb-sm){\n                                            Select(Name:#Name#, Source:#Src#, NameColumn:role_name, ValueColumn: id)\n                                            Div(input-group-btn){\n                                                Button(Class: btn btn-primary fa fa-plus, Page: roles_create, PageParams:\"role_name=Val(role_name),role_type=Val(role_type),rid=#rid#\", Contract:Roles_AccessManager, Params:\"Rid=#rid#,ManagerRid=Val(#Name#),Action=add\")\n                                            }\n                                        }\n                                        ForList(src_roles_access){\n                                            If(#id#==#role_id#){\n                                                Button(Class: btn btn-info mr-sm mb-sm, Page: roles_create, PageParams:\"role_name=Val(role_name),role_type=Val(role_type),rid=#rid#\", Contract:Roles_AccessManager, Params:\"Rid=#rid#,ManagerRid=#id#,Action=remove\", Body: Span(Class: fa fa-remove) #role_name#).Alert(Text: $want_delete_your_role_from_manager$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                                            }.Else{\n                                                Button(Class: btn btn-default mr-sm mb-sm, Page: roles_create, PageParams:\"role_name=Val(role_name),role_type=Val(role_type),rid=#rid#\", Contract:Roles_AccessManager, Params:\"Rid=#rid#,ManagerRid=#id#,Action=remove\"){\n                                                    Span(Class: fa fa-remove)\n                                                    #role_name#\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-right clearfix){\n                        Div(pull-left){\n                            Button(Body: LangRes(back), Class: btn btn-default, Page: roles_list)\n                        }\n                        If(#rid_id#>0){}.Else{\n                            Button(Body: LangRes(create), Class: btn btn-primary, Page: roles_list, Contract: Roles_Create)\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "roles_create",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(app)\n    SetTitle($roles$)\n    AddToolButton(Title: $create$, Page: roles_create, Icon: icon-plus)\n\n    If(GetVar(search)){\n        SetVar(where,\"role_name='#search#'\")\n    }.Else{\n        SetVar(where,\"id>0\").(search,)\n    }\n\n    DBFind(Name: roles, Source: src_roles).Custom(_id){\n        JsonToSource(rids,#roles_access#)\n        If(#deleted# == 0){\n            SetVar(style_text,).(style_link,\"text-primary\")\n        }.Else{\n            SetVar(style_text,\"text-muted\").(style_link,\"text-muted\")\n        }\n        Span(Class: #style_text#, Body: #id#)\n    }.Custom(_creator){\n        If(#role_type#==3){\n        }.ElseIf(And(#creator.member_name#!=NULL,#creator.member_name#!=\"\")){\n            LinkPage(Class: #style_link# text-bold, Page: profile_view, PageParams: \"v_member_id=#creator.member_id#\"){\n                #creator.member_name#\n            }\n        }\n    }.Custom(_name){\n        LinkPage(Class: #style_link# h5 text-bold, Page: roles_view, PageParams: \"v_role_id=#id#\"){\n            If(#image_id#>0){\n                Image(Src: Binary().ById(#image_id#), Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\n                #role_name#\n            }.Else{\n                Div(){\n                    Span(Class: fa icon-settings fa-2x mr-sm).(#role_name#)\n                }.Style(display:flex; align-items:center;)\n            }\n        }\n    }.Custom(_date){\n        Div(#style_text# small){\n            Div(text-nowrap){DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\")}\n            Div(text-nowrap){DateTime(DateTime: #date_deleted#, Format: \"DD.MM.YYYY HH:MI\")}\n        }\n    }.Custom(_type){\n        Span(Class: #style_text#, Body: AppParam(App:#app_id#, Name: roles_types, Index: #role_type#))\n    }.Custom(_status){\n        Span(Class:#style_text#){\n            If(#deleted# == 0){\n                LangRes(active)\n            }.Else{\n                LangRes(deleted)\n            }\n        }\n    }.Custom(_access){\n        If(#creator.member_id#==#key_id#){\n            SetVar(access,done)\n        }.Else{\n            SetVar(access,)\n        }\n        If(#roles_access.rids#!=\"\"){\n            DBFind(roles, src_roles_list).Where(\"id in (#roles_access.rids#)\").Columns(\"id,role_name\").Count(access_count).Order(role_name)\n            Div(#style_text# breaker){\n                ForList(src_roles_list){\n                    If(And(#role_id#==#id#)){\n                        SetVar(access,done)\n                    }\n\n                    If(#access_count#!=#src_roles_list_index#){\n                        Span(\"#role_name#,\",mr-sm)\n                    }.Else{\n                        #role_name#\n                    }\n                }\n            }\n        }\n    }.Custom(_actions){\n        Div(text-right button-group text-nowrap){\n            If(#access#==\"done\"){\n                Button(Class: fa fa-edit btn btn-default, PageParams: \"rid=#id#\", Page: roles_create)\n                If(And(#deleted#==0,#role_type#!=3)){\n                    Button(Class: fa fa-trash btn btn-danger, Contract: Roles_Del, Params: \"rid=#id#\", Page: roles_list).Alert(Text: $sure_want_delete$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                }.ElseIf(#deleted#==1){\n                    Button(Class: fa fa-recycle btn btn-info, Contract: Roles_Restore, Params: \"rid=#id#\", Page: roles_list)\n                }\n            }\n        }\n    }.Where(#where#).Order(\"deleted ASC, id ASC\").Columns(\"id,role_name,role_type,image_id,creator->member_id,creator->member_name,date_created,date_deleted,deleted,roles_access->rids\")\n    Form(panel panel-primary){\n        Div(panel-body){\n            Div(row){\n                Div(col-md-12){\n                    Div(input-group){\n                        Div(input-group-addon mt-sm){\n                            LangRes(name)\n                        }\n                        Input(Name: search, Value: #search#)\n                        Div(input-group-btn){\n                            Button(Body: Em(Class: fa fa-search), Class: btn btn-default, Page: roles_list, PageParams: \"search=Val(search)\")\n                        }\n                    }\n                }\n            }\n            Div(table-responsive){\n                Table(Source: src_roles, Columns: \"$id$=_id,$name$=_name,$type$=_type,$creator$=_creator,$created$ / $deleted$=_date,$status$=_status,$roles_access$=_access,=_actions\")\n            }\n            If(GetVar(search)){\n                Div(row){\n                    Div(col-md-12 mt-lg){\n                        Div(text-center){\n                            Button(Body: $view_all$, Class: btn btn-primary, Page: roles_list)\n                        }\n                    }\n                }\n            }\n        }\n    }\n}.Style(\n    .inline {display:inline-block;}\n    .breaker {word-break: break-all;}\n)",
            "Name": "roles_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Form(){\n    Div(form-group){\n        DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name\").Count(roles_count).Where(\"role_type=1 AND deleted=0\")\n        If(#roles_count#==0){\n            Div(Body: LangRes(send_not_possible))\n            Div(Body: LangRes(no_assigned_roles))\n        }.Else{\n            Select(Name: rid, Source: src_roles, NameColumn: role_name, ValueColumn: id)\n        }\n    }\n    Div(form-group){\n        If(#roles_count#>0){\n            Button(Body: LangRes(sent), Class: btn btn-primary pull-right, Contract: RolesRequest, Page: profile_view)\n        }\n        Button(Body: LangRes(close), Class: btn btn-default pull-right, Page: profile_view)\n    }\n}",
            "Name": "roles_request",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n\tDBFind(Name: notifications, Source: src_notific).Columns(\"page_params->rid,sender->image_id,sender->member_id,sender->member_name\").Where(\"id = #notific_id#\").Vars(notific)\n   \n    Div(row){\n        Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\n            Form(panel panel-default){\n                Div(panel-heading text-center){\n                    Span(Class: h3, Body: Request to role)\n                }\n                Div(panel-body){\n                    Div(form-group){\n                        Div(row){\n                            Div(col-md-12 mt-sm text-center){\n                                If(#notific_sender_image_id#>0){\n                                    Image(Src: Binary().ById(#notific_sender_image_id#), Class: img-thumbnail).Style(width: 120px; border: 1px solid #5A5D63;)\n                                }.Else{\n                                    Span(Class: fa icon-user fa-5x text-primary)\n                                }\n                                Div(m0 h4 text-bold){#notific_sender_member_name#}\n                            }\n                        }\n                    }\n                    Div(list-group-item text-center){\n                        Div(text-muted m0 h5, Body: LangRes(address))\n                        Span(Class: h5 text-bold, Body: Address(#notific_sender_member_id#))\n                    }\n                    Div(list-group-item text-center){\n                        DBFind(Name: roles).Where(\"id=#notific_page_params_rid#\").Columns(\"role_name\").Vars(r)\n                        Div(text-muted m0 h5, Body: LangRes(role))\n                        Span(Class: h5 text-bold, Body: #notific_page_params_rid# - #r_role_name#)\n                    }\n\t\t\t\t\tDiv(list-group-item text-center){\n                        Input(Name: member_id, Class: hidden, Value: #notific_sender_member_id#)\n                        Input(Name: rid, Class: hidden, Value: #notific_page_params_rid#)\n                        Button(Class: btn btn-danger, Body: Reject, Contract: RolesRequestDecision, Page: roles_list, Params: \"notific_id=#notific_id#,decision=0\")\n                        Button(Class: btn btn-success, Body: Accept, Contract: RolesRequestDecision, Page: roles_list, Params: \"notific_id=#notific_id#,decision=1\")\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "roles_request_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    \n    If(#v_role_id# > 0){\n        DBFind(Name: roles, Source: src_roles).Columns(\"role_name,role_type,deleted\").Where(\"id=#v_role_id#\").Vars(prefix)\n        \n        SetTitle($role$: #prefix_role_name#)\n        Div(breadcrumb){\n            LinkPage($roles$, roles_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: #prefix_role_name#)\n        }\n        \n        DBFind(Name: roles_participants, Source: src_participants).Columns(\"id,member->member_id,member->member_name,member->image_id,appointed->member_id,appointed->member_name,appointed->voting_id,appointed->voting_name,date_created,date_deleted,deleted\").Custom(custom_id){\n            If(#deleted# == 0){\n                SetVar(Name: style_text, Value: \"text-normal\")\n                SetVar(Name: style_link, Value: \"text-primary\")\n            }.Else{\n                SetVar(Name: style_text, Value: \"text-muted\")\n                SetVar(Name: style_link, Value: \"text-muted\")\n            }\n            Span(Class: #style_text#, Body: #id#)\n        }.Custom(custom_appointed){\n            If(Or(#appointed.member_id#>0,#appointed.member_id#<0)){\n                LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#appointed.member_id#\"){\n                    Span(Body: #appointed.member_name#)\n                }\n            }\n            If(#appointed.voting_id#>0){\n                LinkPage(Page: voting_view, PageParams: \"vID=#appointed.voting_id#\"){\n                    Span(Class: h5 text-bold, Body: #appointed.voting_name#)\n                }\n            }\n        }.Custom(custom_member){\n            LinkPage(Class: #style_link# h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#member.member_id#\"){\n                If(#member.image_id#>0){\n                    Image(Src: Binary().ById(#member.image_id#), Class: img-circle).Style(width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n                    Span(#member.member_name#)\n                }.Else{\n                    Div(){\n                        Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n                        Span(#member.member_name#)\n                    }.Style(display:flex; align-items:center;)\n                }\n            }\n        }.Custom(custom_address){\n            Span(Class: #style_text#, Body: Address(#member.member_id#))\n        }.Custom(custom_date){\n            Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_created#, Format: \"DD.MM.YYYY HH:MI\"))\n            Div(Class: #style_text# h6 m0, Body: DateTime(DateTime: #date_deleted#, Format: \"DD.MM.YYYY HH:MI\"))\n        }.Custom(custom_status){\n            If(#deleted# == 0){\n                Span(Class: #style_text#, Body: LangRes(active))\n            }.Else{\n                Span(Class: #style_text#, Body: LangRes(deleted))\n            }\n        }.Custom(actions){\n            Div(pull-right){\n                If(And(#deleted#==0,#prefix_role_type#!=3)){\n                    Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, Contract: Roles_Unassign, Params: \"row_id=#id#\", Page: roles_view, PageParams: \"v_role_id=#v_role_id#\").Alert(Text: $sure_want_delete$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                }\n            }\n        }.Where(\"role->id='#v_role_id#'\").Order(\"deleted ASC, id ASC\")\n        \n        Form(panel panel-primary){\n            Div(panel-body){\n                Table(Source: src_participants, Columns: \"$id$=custom_id,$member$=custom_member,$address$=custom_address,$appointed$=custom_appointed,$appointed$ / $deleted$=custom_date,$status$=custom_status,=actions\")\n            }\n            Div(panel-footer text-right){\n                Button(Body: LangRes(back), Class: btn btn-default, Page: roles_list)\n                If(#prefix_deleted#==0){\n                    Button(Body: LangRes(assign), Class: btn btn-primary, Page: roles_assign, PageParams: \"v_role_id=#v_role_id#\")\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "roles_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Form(){\n    If(Or(#v_id#>0,#v_id#<0)){\n        SetVar(Name: v_address, Value: Address(#v_id#))\n    }.Else{\n        SetVar(Name: v_address, Value: \"\")\n    }\n    Div(form-group){\n        Label($recipient$)\n        Input(Name: Recipient_Account, Placeholder: \"xxxx-xxxx-xxxx-xxxx-xxxx\", Value: #v_address#)\n    }\n    Div(form-group){\n        Label($amount$)\n        Input(Name: Amount, Type: Number)\n    }\n    Div(form-group){\n        Button(Body: LangRes(send), Class: btn pull-right btn-primary, Page: members_list, Contract: SendTokens).Alert(Text: $want_send_tokens$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n        Button(Body: LangRes(back), Class: btn pull-right btn-default, Page: members_list)\n    }\n}",
            "Name": "tokens_transfer",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\n\nSetTitle($new_voting$)\nAppParam(App:#application_id#, Name: type_voting_decisions, Source: type_voting_decisions)\nAppParam(App:#application_id#, Name: type_voting_participants, Source: type_voting_participants)\nData(inputs,\"Name,Type,Res,Req,Src,Val,Desc\"){\n    voting_name,input,name,*,,\"New voting\",\n    type_decision,select,decision,*,type_voting_decisions,,\n    type_participants,select,participants,*,type_voting_participants,,\n    volume,number,voting_volume,*,,75,$voting_volume_desc$\n    quorum,number,voting_quorum,*,,51,$voting_quorum_desc$\n    start,datetime,date_start,*,,,\n    end,datetime,date_end,*,,,\n    description,textarea,description,,,,\n\n}\nDiv(content-wrapper){\n    Div(breadcrumb){\n        LinkPage($voting$, voting_list)\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\n        Span(Class: text-muted, Body: $new_voting$)\n    }\n\n    Div(row){\n        Div(col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2){\n            Form(panel panel-primary){\n                Div(panel-heading){LangRes(new_voting)}\n                Div(panel-body){\n                    ForList(inputs){\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(For:#Name#){\n                                        LangRes(#Res#)\n                                        If(#Req#==*){\n                                            Span(*,text-danger)\n                                        }\n                                    }\n                                }\n                                Div(col-md-9 text-left){\n                                    If(#Type#==input){\n                                        Input(Name: #Name#, Value: #Val#)\n                                    }.ElseIf(#Type#==select){\n                                        Select(Name: #Name#, Source: #Src#, NameColumn: name, ValueColumn: id)\n                                    }.ElseIf(#Type#==number){\n                                        Input(Name: #Name#, Value: #Val#, Type:#Type#)\n                                    }.ElseIf(#Type#==textarea){\n                                        Input(Name: #Name#, Type:#Type#)\n                                    }.ElseIf(#Type#==datetime){\n                                        Div(row){\n                                            Div(col-md-6){\n                                                Input(Name: #Name#_date, Type: date)\n                                            }\n                                            Div(col-md-6){\n                                                Input(Name: #Name#_time, Type: time)\n                                            }\n                                        }\n                                    }\n\n                                    If(`#Desc#`!=\"\"){\n                                        Div(m0 text-muted){\n                                            #Desc#\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n                Div(panel-footer text-right){\n                    Div(pull-left){\n                        Button(Body: LangRes(back), Class: btn btn-default, Page: voting_list)\n                    }\n                    Input(Name: voting_type, Type: hidden, Value: 1)\n                    Button(Body: LangRes(create), Class: btn btn-primary, Page: voting_list, Contract: voting_CreateNew)\n                }\n            }\n        }\n    }\n}",
            "Name": "voting_create",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(#vID# > 0){\n        DBFind(Name: votings, Source: src_voting).Columns(\"id,voting->name,optional->role_id,optional->role_vacancies,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Where(\"id=#vID#\").Vars(instance)\n        DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name\").Where(\"role_type=2 and deleted=0\").Count(elective_roles_count)\n\n        SetTitle($subject_voting$)\n        Div(breadcrumb){\n            LinkPage($voting$, voting_list)\n            Span(/,mh)\n            LinkPage(#instance_voting_name#, voting_view,, \"vID=#vID#\")\n            Span(/,mh)\n            Span(Class: text-muted, Body: $subject_voting$)\n        }\n        If(#elective_roles_count#>0){\n            Div(row mt-sm){\n                Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n                    Form(panel panel-primary){\n                        Div(panel-body){\n                            Div(row mt-sm){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(candidates))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 text-left){\n                                    Div(input-group){\n                                        Input(Name: can_apply_voting, Disabled: 1, Value: \"$can_apply_voting$\")\n                                        Div(input-group-btn){\n                                            Button(Body: LangRes(apply), Class: btn btn-primary, Page: voting_decision_candidates, PageParams: \"vID=#vID#\", Contract: voting_SubjectCandidates)\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row mt-sm){\n                                Div(col-lg-8 col-lg-offset-3){\n                                    DBFind(Name: votings_subject, Source: src_voting_subject).Columns(\"id,subject->member_id,subject->member_name\").Where(\"voting_id=#vID#\").Custom(custom_address){\n                                        Address(#subject.member_id#)\n                                    }.Custom(custom_member){\n                                        LinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#subject.member_id#\"){\n                                            Span(Body: #subject.member_name#)\n                                        }\n                                    }\n                                    Table(src_voting_subject, \"$candidates$=custom_member,$address$=custom_address\")\n                                }\n                            }\n                            Div(form-group){\n                                Div(row mt-sm){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(role))\n                                            Span(Class: text-danger, Body:*)\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        Select(Name: roleID, Source: src_roles, NameColumn: role_name, ValueColumn: id, Value: #instance_optional_role_id#)\n                                    }\n                                }\n                                Div(row mt-sm){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(vacancies))\n                                            Span(Class: text-danger, Body:*)\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        Input(Name: vacancies, Type: Number, Value: #instance_optional_role_vacancies#)\n                                    }\n                                }\n                            }\n                            Div(form-group){\n                                Div(row mt-sm){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(contract_accept))\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        Input(Name: contract_accept, Value: #instance_optional_contract_accept#, Placeholder: \"$contract_accept_des$\").Validate(minLength:3, maxLength:255)\n                                        InputErr(Name: contract_accept, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                    }\n                                }\n                                Div(row mt-sm){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(params))\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        Input(Name: contract_accept_params, Value: #instance_optional_contract_accept_params#, Placeholder: \"$contract_params_des$\")\n                                    }\n                                }\n                                Div(row mt-sm){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(contract_reject))\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        Input(Name: contract_reject, Value: #instance_optional_contract_reject#, Placeholder: \"$contract_reject_des$\").Validate(minLength:3, maxLength:255)\n                                        InputErr(Name: contract_reject, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                    }\n                                }\n                                Div(row mt-sm){\n                                    Div(col-md-3 mt-sm text-right){\n                                        Label(){\n                                            Span(Body: LangRes(params))\n                                        }\n                                    }\n                                    Div(col-md-9 text-left){\n                                        Input(Name: contract_reject_params, Value: #instance_optional_contract_reject_params#, Placeholder: \"$contract_params_des$\")\n                                    }\n                                }\n                            }\n                        }\n                        Div(panel-footer text-right){\n                            Div(pull-left){\n                                Button(Body: LangRes(back), Class: btn btn-default, Page: voting_view, PageParams: \"vID=#vID#\")\n                            }\n                            Input(Name: memberID, Type: hidden, Value: 0)\n                            Input(Name: votingID, Type: hidden, Value: #vID#)\n                            Button(Body: LangRes(save), Class: btn btn-primary, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_SubjectSettings)\n                        }\n                    }\n                }\n            }\n        }.Else{\n            Div(row){\n                Div(col-md-12 text-center h3){\n                    P(LangRes(elective_roles_not_found))\n                    LinkPage(Body: LangRes(create_role), Page: roles_create)\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "voting_decision_candidates",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(#vID# > 0){\n        DBFind(Name: votings, Source: src_voting).Columns(\"id,voting->name\").Where(\"id=#vID#\").Vars(instance)\n        DBFind(Name: votings_subject, Source: src_subject).Columns(\"id,subject->contract_accept,subject->contract_reject,subject->contract_accept_params,subject->contract_reject_params\").Where(\"voting_id=#vID#\").Vars(prefix)\n\n        If(#prefix_id#>0){\n        }.Else{\n            SetVar(Name: prefix_subject_contract_accept, Value: \"\")\n            SetVar(Name: prefix_subject_contract_accept_params, Value: \"\")\n            SetVar(Name: prefix_subject_contract_reject, Value: \"\")\n            SetVar(Name: prefix_subject_contract_reject_params, Value: \"\")\n        }\n\n        SetTitle($subject_voting$)\n        Div(breadcrumb){\n            LinkPage($voting$, voting_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            LinkPage(#instance_voting_name#, voting_view,, \"vID=#vID#\")\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: $subject_voting$)\n        }\n\n        Div(row){\n            Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-body){\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(contract_accept)).(Class: text-danger, Body:*)\n                                }\n                            }\n                            Div(col-md-9 mb-sm text-left){\n                                Input(Name: contract_accept, Value: #prefix_subject_contract_accept#, Placeholder: \"$contract_accept_des$\").Validate(minLength:3, maxLength:255)\n                                InputErr(Name: contract_accept, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                            }\n                        }\n                        Div(row){\n                            Div(col-md-3 mt-sm text-right){\n                                Label(){\n                                    Span(Body: LangRes(params))\n                                }\n                            }\n                            Div(col-md-9 mc-sm text-left){\n                                Input(Name: contract_accept_params, Value: #prefix_subject_contract_accept_params#, Placeholder: \"$contract_params_des$\")\n                            }\n                        }\n\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_reject)).(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_reject, Value: #prefix_subject_contract_reject#, Placeholder: \"$contract_reject_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_reject, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: contract_reject_params, Value: #prefix_subject_contract_reject_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-right){\n                        Div(pull-left){\n                            Button(Body: LangRes(back), Class: btn btn-default, Page: voting_view, PageParams: \"vID=#vID#\")\n                        }\n                        Input(Name: votingID, Type: hidden, Value: #vID#)\n                        Button(Body: LangRes(save), Class: btn btn-primary, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_SubjectContract)\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "voting_decision_contract",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(#vID# > 0){\n        DBFind(Name: votings, Source: src_voting).Columns(\"id,voting->name,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Where(\"id=#vID#\").Vars(instance)\n        DBFind(Name: votings_subject, Source: src_voting_subject).Columns(\"id,subject->text\").Where(\"voting_id=#vID#\").Vars(prefix)\n\n        If(#prefix_id#>0){\n        }.Else{\n            SetVar(Name: prefix_subject_text, Value: \"\")\n        }\n\n        SetTitle($subject_voting$)\n        Div(breadcrumb){\n            LinkPage($voting$, voting_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            LinkPage(#instance_voting_name#, voting_view,, \"vID=#vID#\")\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: $subject_voting$)\n        }\n\n        Div(row){\n            Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-body){\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-12 mt-sm){\n                                    Label(){\n                                        Span(Body: LangRes(text_document))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                    Input(Name: text_document, Type: textarea, Value: #prefix_subject_text#)\n                                }\n                            }\n                        }\n                        Div(form-group){\n                            Div(row mb-sm){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_accept))\n                                    }\n                                }\n                                Div(col-md-9 text-left){\n                                    Input(Name: contract_accept, Value: #instance_optional_contract_accept#, Placeholder: \"$contract_accept_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_accept, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row mb-sm){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 text-left){\n                                    Input(Name: contract_accept_params, Value: #instance_optional_contract_accept_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                            Div(row mb-sm){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_reject))\n                                    }\n                                }\n                                Div(col-md-9 text-left){\n                                    Input(Name: contract_reject, Value: #instance_optional_contract_reject#, Placeholder: \"$contract_reject_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_reject, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: contract_reject_params, Value: #instance_optional_contract_reject_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-right){\n                        Div(pull-left){\n                            Button(Body: LangRes(back), Class: btn btn-default, Page: voting_view, PageParams: \"vID=#vID#\")\n                        }\n                        Input(Name: votingID, Type: hidden, Value: #vID#)\n\n                        Button(Body: LangRes(save), Class: btn btn-primary, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_SubjectDocument)\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "voting_decision_document",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(#vID# > 0){\n        DBFind(Name: votings, Source: src_voting).Columns(\"id,voting->name,optional->role_id,optional->role_vacancies,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Where(\"id=#vID#\").Vars(instance)\n\n        SetTitle($subject_voting$)\n        Div(breadcrumb){\n            LinkPage($voting$, voting_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            LinkPage(#instance_voting_name#, voting_view,, \"vID=#vID#\")\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: $subject_voting$)\n        }\n\n        Div(row){\n            Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-body){\n                        Div(list-group-item){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(candidates)).(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Div(input-group){\n                                        DBFind(keys,src_keys).Columns(\"id\").Custom(_name){\n                                            DBFind(members).Columns(\"id,member_name\").Where(\"id=#id#\").Vars(m)\n                                            Address(#id#)\n                                            If(Or(#m_id#>0,#m_id#<0)){\n                                                \" (#m_member_name#)\"\n                                            }\n                                        }\n                                        Select(Name: memberID, Source: src_keys, NameColumn: _name, ValueColumn: id)\n                                        Div(input-group-btn){\n                                            Button(Body: LangRes(add), Class: btn btn-primary, Page: voting_decision_election, PageParams: \"vID=#vID#\", Contract: voting_SubjectCandidates)\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row){\n                                Div(col-lg-8 col-lg-offset-3){\n                                    DBFind(Name: votings_subject, Source: src_subject).Columns(\"id,subject->member_id,subject->member_name\").Where(\"voting_id=#vID#\").Custom(custom_address){\n                                        Address(#subject.member_id#)\n                                    }.Custom(custom_member){\n                                        LinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#subject.member_id#\"){\n                                            Span(Body: #subject.member_name#)\n                                        }\n                                    }\n                                    Table(src_subject, \"$candidates$=custom_member,$address$=custom_address\")\n                                }\n                            }\n                        }\n                        Div(list-group-item){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(role)).(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name\").Where(\"role_type=2 and deleted=0\").Count(count_roles)\n                                    If(#count_roles#>0){\n                                        Select(Name: roleID, Source: src_roles, NameColumn: role_name, ValueColumn: id, Value: #instance_optional_role_id#)\n                                    }.Else{\n                                        elected role is not found\n                                    }\n                                }\n                            }\n\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(vacancies)).(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: vacancies, Class: form-control, Type: Number, Value: #instance_optional_role_vacancies#)\n                                }\n                            }\n                        }\n                        Div(list-group-item){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_accept))\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_accept, Value: #instance_optional_contract_accept#, Placeholder: \"$contract_accept_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_accept, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_accept_params, Value: #instance_optional_contract_accept_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_reject))\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_reject, Value: #instance_optional_contract_reject#, Placeholder: \"$contract_reject_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_reject, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: contract_reject_params, Value: #instance_optional_contract_reject_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-right){\n                        Div(pull-left){\n                            Button(Body: LangRes(back), Class: btn btn-default, Page: voting_view, PageParams: \"vID=#vID#\")\n                        }\n                        Input(Name: votingID, Type: hidden, Value: #vID#)\n                        Button(Body: LangRes(save), Class: btn btn-primary, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_SubjectSettings)\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "voting_decision_election",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(#vID# > 0){\n        DBFind(Name: votings, Source: src_voting).Columns(\"id,voting->name,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Where(\"id=#vID#\").Vars(instance)\n        DBFind(Name: votings_subject, Source: src_subject).Columns(\"id,subject->column,subject->column_value,subject->table_id,subject->table,subject->description\").Where(\"voting_id=#vID#\").Vars(prefix)\n\n        If(#prefix_id#>0){\n        }.Else{\n            SetVar(Name: prefix_subject_description, Value: \"\")\n            SetVar(Name: prefix_subject_table, Value: \"\")\n            SetVar(Name: prefix_subject_table_id, Value: \"\")\n            SetVar(Name: prefix_subject_column, Value: \"\")\n            SetVar(Name: prefix_subject_column_value, Value: \"\")\n        }\n\n        SetTitle($subject_voting$)\n        Div(breadcrumb){\n            LinkPage($voting$, voting_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            LinkPage(#instance_voting_name#, voting_view,, \"vID=#vID#\")\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: $subject_voting$)\n        }\n\n        Div(row){\n            Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-body){\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(table_to_written))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: table_to_written, Value: #prefix_subject_table#, Placeholder: \"$table_to_written_desc$\")\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(row_id))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: row_id, Class: form-control, Type: number, Value: #prefix_subject_table_id#, Placeholder: \"$row_id_desc$\")\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(column_name))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: column_name, Value: #prefix_subject_column#, Placeholder: \"$column_name_desc$\")\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(written_value))\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: written_value, Value: #prefix_subject_column_value#, Placeholder: \"$written_value_desc$\")\n                                }\n                            }\n                        }\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-3 mt-lg text-right){\n                                    Label(){\n                                        Span(Body: LangRes(description))\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: description, Class: form-control, Type: textarea, Value: #prefix_subject_description#)\n                                }\n                            }\n                        }\n                        Div(form-group){\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_accept))\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_accept, Value: #instance_optional_contract_accept#, Placeholder: \"$contract_accept_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_accept, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_accept_params, Value: #instance_optional_contract_accept_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(contract_reject))\n                                    }\n                                }\n                                Div(col-md-9 mb-sm text-left){\n                                    Input(Name: contract_reject, Value: #instance_optional_contract_reject#, Placeholder: \"$contract_reject_des$\").Validate(minLength:3, maxLength:255)\n                                    InputErr(Name: contract_reject, minLength: $validate_contract_name$, maxLength: $validate_contract_name$)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-3 mt-sm text-right){\n                                    Label(){\n                                        Span(Body: LangRes(params))\n                                    }\n                                }\n                                Div(col-md-9 mc-sm text-left){\n                                    Input(Name: contract_reject_params, Value: #instance_optional_contract_reject_params#, Placeholder: \"$contract_params_des$\")\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-right){\n                        Div(pull-left){\n                            Button(Body: LangRes(back), Class: btn btn-default, Page: voting_view, PageParams: \"vID=#vID#\")\n                        }\n                        Input(Name: votingID, Type: hidden, Value: #vID#)\n                        Button(Body: LangRes(save), Class: btn btn-primary, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_SubjectFormal)\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "voting_decision_formal",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "Div(content-wrapper){\n    If(#vID# > 0){\n        DBFind(Name: votings, Source: src_voting).Columns(\"id,voting->name,voting->type_participants\").Where(\"id=#vID#\").Vars(instance)\n\n        SetTitle($participants$)\n        Div(breadcrumb){\n            LinkPage($voting$, voting_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            LinkPage(#instance_voting_name#, voting_view,, \"vID=#vID#\")\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: $participants$)\n        }\n\n        Div(row){\n            Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-heading){LangRes(participants)}\n                    Div(panel-body){\n                        Div(form-group){\n                            If(#instance_voting_type_participants# == 1){\n                                Div(row){\n                                    Div(col-md-12){\n                                        Input(Name: voting_all_members, Disabled: 1, Value: \"$voting_all_members$\")\n                                    }\n                                }\n                            }\n                            If(#instance_voting_type_participants# == 2){\n                                Div(row){\n                                    Div(col-md-12){\n                                        Label(){\n                                            Span(Body: LangRes(select_member))\n                                            Span(Class: text-danger, Body:*)\n                                        }\n                                        DBFind(keys,src_keys).Columns(\"id\").Custom(_name){\n                                            DBFind(members).Columns(\"id,member_name\").Where(\"id=#id#\").Vars(m)\n                                            Address(#id#)\n                                            If(Or(#m_id#>0,#m_id#<0)){\n                                                \" (#m_member_name#)\"\n                                            }\n                                        }\n                                        Select(Name: var_id, Source: src_keys, NameColumn: _name, ValueColumn: id)\n                                    }\n                                }\n                            }\n                            If(#instance_voting_type_participants# == 3){\n                                Div(row){\n                                    Div(col-md-12){\n                                        Label(){\n                                            Span(Body: LangRes(select_role))\n                                            Span(Class: text-danger, Body:*)\n                                        }\n                                        DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name\").Where(\"deleted=0\")\n                                        Select(Name: var_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\n                                    }\n                                }\n                            }\n                        }\n                        DBFind(Name: votings_participants, Source: src_participants).Columns(\"id\").Where(\"voting_id=#vID#\").Vars(participant)\n                        If(#participant_id#>0){\n                            Div(form-group){\n                                Div(row){\n                                    Div(col-md-12){\n                                        DBFind(Name: votings_participants, Source: src_participants).Columns(\"id,member->member_id,member->member_name\").Where(\"voting_id=#vID#\").Custom(custom_id){\n                                            Span(Body: #id#)\n                                        }.Custom(custom_member){\n                                            LinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#member.member_id#\"){\n                                                Span(Body: #member.member_name#)\n                                            }\n                                        }\n                                        Table(src_participants, \"$id$=custom_id,$member_name$=custom_member\")\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-left){\n                        Button(Body: LangRes(back), Class: btn btn-default, Page: voting_view, PageParams: \"vID=#vID#\")\n                        Input(Name: votingID, Type: hidden, Value: #vID#)\n                        If(#instance_voting_type_participants# == 2){\n                            Button(Body: LangRes(add_member), Class: btn btn-primary pull-right, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_Invite)\n                        }.ElseIf(#instance_voting_type_participants# == 3){\n                            Button(Body: LangRes(add_role), Class: btn btn-primary pull-right, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_Invite)\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}",
            "Name": "voting_invite",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "\nDBFind(applications,src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\nSetTitle(\"List of votings\")\n\nIf(GetVar(Search)){\n    SetVar(Where,\"voting->name='#Search#' and deleted=0\")\n}.Else{\n    SetVar(Where,\"deleted=0\").(Search,)\n}\n\nDBFind(votings,src_voting).Custom(_id){\n    Span(Class: h5, Body: #id#)\n\n    DBFind(votings).Columns(\"date_started\").Where(\"id=#id# and date_started < now()\").Vars(started)\n    DBFind(votings).Columns(\"date_ended\").Where(\"id=#id# and date_ended < now()\").Vars(ended)\n\n    If(#started_id#>0){\n        SetVar(isStarted,1).(startedClass,text-muted)\n    }.Else{\n        SetVar(isStarted,-1).(startedClass,text-bold)\n    }\n    If(#ended_id#>0){\n        SetVar(isEnded,1).(endedClass,text-muted)\n    }.Else{\n        SetVar(isEnded,-1).(endedClass,text-bold)\n    }\n}.Custom(_name){\n    LinkPage(Page: voting_view, PageParams: \"vID=#id#\"){\n        Span(Class: h5 text-bold m0, Body: #voting.name#)\n    }\n}.Custom(_subject){\n    SetVar(decision, AppParam(App:#application_id#, Name: type_voting_decisions, Index: #voting.type_decision#))\n    Div(h6 m0){\n        If(Or(#isStarted#>0,#voting.type#==2)){\n            #decision#\n        }.Else{\n            If(#voting.type_decision# == 1){\n                SetVar(Page,voting_decision_candidates)\n            }.ElseIf(#voting.type_decision# == 2){\n                SetVar(Page,voting_decision_election)\n            }.ElseIf(#voting.type_decision# == 3){\n                SetVar(Page,voting_decision_document)\n            }.ElseIf(#voting.type_decision# == 4){\n                SetVar(Page,voting_decision_formal)\n            }.ElseIf(#voting.type_decision# == 5){\n                SetVar(Page,voting_decision_contract)\n            }\n            LinkPage(Page: #Page#, PageParams: \"vID=#id#\", Class:text-bold, Body: #decision#)\n        }\n    }\n}.Custom(_participants){\n    SetVar(participants, AppParam(App:#application_id#, Name: type_voting_participants, Index: #voting.type_participants#))\n    Div(h6 m0){\n        If(Or(#isStarted#>0,#voting.type#==2)){\n            #participants#\n        }.Else{\n            LinkPage(Page: voting_invite, PageParams: \"vID=#id#\", Class:text-bold, Body: #participants#)\n        }\n    }\n}.Custom(_creator){\n    LinkPage(Class: text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#creator.member_id#\", Body: #creator.member_name#)\n}.Custom(_date){\n    Div(Class: #startedClass#, Body: DateTime(DateTime: #date_started#, Format: \"DD.MM.YYYY HH:MI\"))\n    Div(Class: #endedClass#, Body: DateTime(DateTime: #date_ended#, Format: \"DD.MM.YYYY HH:MI\"))\n}.Custom(_type){\n    Span(Class: h6 m0, Body: AppParam(App:#application_id#, Name: type_voting, Index: #voting.type#))\n}.Custom(_progress){\n    Div(Class: text-center h5 text-bold, Body: #progress.percent_success# %)\n}.Custom(_decision){\n    Div(text-center){\n        If(#flags.decision# == 0){\n            If(And(#isEnded#>0,#creator.member_id#==#key_id#)){\n                Button(Body: LangRes(decision), Class: btn btn-primary, Contract: voting_CheckDecision, Params: \"votingID=#id#\", Page: voting_list)\n            }.Else{\n                Div(text-muted){LangRes(no)}\n            }\n        }.ElseIf(#flags.decision# == -2){\n            Div(text-muted){LangRes(not_enough_votes)}\n        }.ElseIf(#flags.decision# == 1){\n            Div(text-success){LangRes(accepted)}\n        }.ElseIf(#flags.decision# == -1){\n            Div(text-danger){LangRes(rejected)}\n        }\n    }\n}.Custom(_status){\n    Div(text-center){\n        If(#flags.success# == 1){\n            Span(Class: text-success, Body: LangRes(success))\n        }.ElseIf(#isEnded#>0){\n            Span(Class: text-muted, Body: LangRes(finished))\n        }.ElseIf(#isStarted#>0){\n            If(And(#flags.full_data#==1,#progress.number_participants#>0)){\n                Button(Class: btn btn-link icon-eye, Page: voting_view, PageParams: \"vID=#id#\")\n            }.Else{\n                Span(Class:text-danger, Body: LangRes(invalid))\n            }\n        }.Else{\n            Span(Class: text-warning, Body: LangRes(waiting))\n        }\n    }\n}.Custom(_actions){\n    Div(text-right){\n        If(And(#creator.member_id#==#key_id#,Or(#flags.full_data#==0,#progress.number_participants#==0,#isStarted#<0))){\n            Button(Class: fa fa-trash btn btn-default, Contract: voting_Delete, Params: \"votingID=#id#\", Page: voting_list).Alert(Text: $want_delete_voting$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n        }\n    }\n}.Where(#Where#).Order(id desc).Columns(\"id,voting->name,voting->type,voting->type_decision,voting->type_participants,flags->success,flags->decision,flags->full_data,progress->percent_success,progress->number_participants,creator->member_id,creator->member_name,date_started,date_ended,deleted\")\n\nAddToolButton(Title: $create$, Page: voting_create, Icon: icon-plus)\nDiv(content-wrapper){\n    Form(panel panel-primary){\n        Div(panel-body){\n            Div(row){\n                Div(col-md-12){\n                    Div(input-group){\n                        Div(input-group-addon){\n                            LangRes(name)\n                        }\n                        Input(Name: Search, Value: #Search#)\n                        Div(input-group-btn){\n                            Button(Body: Em(Class: fa fa-search), Class: btn btn-default, Page: voting_list, PageParams: \"Search=Val(Search)\")\n                        }\n                    }\n                }\n                Div(col-md-12){\n                    Div(table-responsive){\n                        Table(src_voting, \"$id$=_id,$name$=_name,$type$=_type,$subject_voting$=_subject,$participants$=_participants,$date_start$/$date_end$=_date,$creator$=_creator,$progress$=_progress,$decision$=_decision,$status$=_status,=_actions\")\n                    }\n                }\n            }\n            If(GetVar(Search)){\n                Div(row){\n                    Div(col-md-12 mt-lg){\n                        Div(text-center){\n                            Button(Body: $view_all$, Class: btn btn-default, Page: voting_list)\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "voting_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Value": "DBFind(applications,src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(application)\nIf(#notific_id#>0){\n    DBFind(notifications,src_notifications).Where(\"id=#notific_id#\").Columns(\"page_params->voting_id\").Vars(notific)\n    SetVar(vID,#notific_page_params_voting_id#)\n}\n\nDiv(content-wrapper){\n    If(#vID# > 0){\n        DBFind(votings).Columns(\"id,voting->name,voting->volume,voting->quorum,voting->type,voting->type_decision,voting->description,optional->role_id,optional->role_vacancies,optional->number_candidates,optional->contract_accept,optional->contract_reject,progress->number_participants,progress->number_voters,progress->percent_success,progress->percent_voters,flags->success,flags->full_data,flags->decision,flags->notifics,date_started,date_ended\").Where(\"id=#vID#\").Vars(instance)\n        DBFind(votings).Columns(\"date_started\").Where(\"id=#vID# and date_started < now()\").Vars(started)\n        DBFind(votings).Columns(\"date_ended\").Where(\"id=#vID# and date_ended < now()\").Vars(ended)\n\n        If(#started_id#>0){\n            SetVar(isStarted,1)\n        }.Else{\n            SetVar(isStarted,-1)\n        }\n        If(#ended_id#>0){\n            SetVar(isEnded,1)\n        }.Else{\n            SetVar(isEnded,-1)\n        }\n        SetTitle(Viewing voting: #instance_voting_name#)\n\n        DBFind(votings_participants,src_check).Columns(\"id\").Where(\"voting_id=#vID# and member->member_id='#key_id#' and decision=0\").Vars(participant)\n        If(And(#isStarted#>0,#isEnded#<0,#instance_flags_full_data#==1,#instance_flags_decision#==0,#participant_id#>0)){\n            SetVar(isVotingAllowed,1)\n        }.Else{\n            SetVar(isVotingAllowed,0)\n        }\n        Div(breadcrumb){\n            LinkPage(Body:Votings list, Page:voting_list)\n            Span(/).Style(margin-right: 10px; margin-left: 10px;)\n            Span(Class: text-muted, Body: ##instance_id#)\n        }\n        Div(row mt-sm){\n            Div(col-lg-10 col-lg-offset-1){\n                Form(panel panel-default){\n                    Input(Type: hidden, Name: votingID, Value: #vID#)\n\n                    Div(list-group-item text-center){\n                        P(Class: h3 text-bold m0, Body: #instance_voting_name#)\n                        Div(row mt-sm){\n                            Div(col-md-12){\n                                Div(Class: t5 text-muted m0, Body: AppParam(App:#application_id#, Name: type_voting_decisions, Index: #instance_voting_type_decision#))\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                Div(Class: t5 text-muted m0, Body: LangRes(description))\n                            }\n                            Div(col-md-6 text-left break){\n                                Div(Class: t5 text-muted m0, Body: #instance_voting_description#)\n                            }\n                        }\n                    }\n\n                    Div(list-group-item text-center){\n                        Div(row mt-sm t4){\n                            Div(col-md-6 text-right){\n                                LangRes(type)\n                            }\n                            Div(col-md-6 text-left){\n                                AppParam(App:#application_id#, Name: type_voting, Index: #instance_voting_type#)\n                            }\n                        }\n                        If(Or(#instance_voting_type_decision#==1,#instance_voting_type_decision#==2,#instance_voting_type_decision#==3,#instance_voting_type_decision#==4)){\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(contract_accept)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#instance_optional_contract_accept# == \"\"){\n                                        Span(Class: text-muted, Body: LangRes(optional))\n                                    }.Else{\n                                        #instance_optional_contract_accept#\n                                    }\n                                }\n                            }\n                            Div(row t5 mt-sm){\n                                Div(col-md-6 text-right){\n                                    LangRes(contract_reject)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#instance_optional_contract_reject# == \"\"){\n                                        Span(Class: text-muted, Body: LangRes(optional))\n                                    }.Else{\n                                        #instance_optional_contract_reject#\n                                    }\n                                }\n                            }\n                        }\n                        Div(row mt-sm t5){\n                            Div(col-md-6 text-right){\n                                LangRes(filled)\n                            }\n                            Div(col-md-6 text-left){\n                                If(#instance_flags_full_data# == 1){\n                                    Span(Class: text-success, Body: LangRes(yes))\n                                }.Else{\n                                    Span(Class: text-danger, Body: LangRes(no))\n                                }\n                            }\n                        }\n                        If(Or(#instance_voting_type_decision#==1,#instance_voting_type_decision#==2)){\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(role)\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#instance_optional_role_id# > 0){\n                                        DBFind(Name: roles, Source: src_roles).Columns(\"id,role_name\").Where(\"id=#instance_optional_role_id#\").Vars(prefix)\n                                        #prefix_role_name# (LangRes(id): #prefix_id#)\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(empty))\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(vacancies)\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#instance_optional_role_vacancies# > 0){\n                                        #instance_optional_role_vacancies#\n                                    }.Else{\n                                        Span(Class: text-danger, Body: #instance_optional_role_vacancies#)\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(candidates)\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#instance_optional_number_candidates# > 0){\n                                        #instance_optional_number_candidates#\n                                    }.Else{\n                                        Span(Class:text-danger, Body: #instance_optional_number_candidates#)\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t6){\n                                Div(col-sm-8 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    DBFind(Name: votings_subject, Source: src_voting_subject).Columns(\"id,subject->member_id,subject->member_name\").Where(\"voting_id=#vID#\").Custom(custom_address){\n                                        Address(#subject.member_id#)\n                                    }.Custom(custom_member){\n                                        LinkPage(Class: text-primary t5 text-bold, Page: profile_view, PageParams: \"v_member_id=#subject.member_id#\"){\n                                            #subject.member_name#\n                                        }\n                                    }.Custom(custom_voting){\n                                        If(#isVotingAllowed#==1){\n                                            Button(Body: LangRes(vote), Class: btn btn-success, Page: voting_view, PageParams: \"vID=#vID#\", Contract: voting_AcceptCandidates, Params: \"candidateID=#subject.member_id#\")\n                                        }\n                                    }.Order(\"id\")\n                                    Table(src_voting_subject, \"=custom_member,=custom_address,=custom_voting\")\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-12){\n                                    If(And(#isStarted#<0,#instance_voting_type#==1)){\n                                        If(#instance_voting_type_decision#==1){\n                                            Button(Class: btn btn-link, Page: voting_decision_candidates, PageParams: \"vID=#vID#\"){\n                                                Strong(LangRes(subject_voting_edit))\n                                            }\n                                        }\n                                        If(#instance_voting_type_decision#==2){\n                                            Button(Class: btn btn-link, Page: voting_decision_election, PageParams: \"vID=#vID#\"){\n                                                Strong(LangRes(subject_voting_edit))\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        If(#instance_voting_type_decision#==3){\n                            DBFind(Name: votings_subject, Source: src_voting_subject).Columns(\"id,subject->text,subject->hash\").Where(\"voting_id=#vID#\").Vars(subject)\n                            Div(row t5 mt-lg){\n                                Div(col-sm-8 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    Div(list-group-item){\n                                        If(#subject_id# > 0){\n                                            #subject_subject_text#\n                                        }.Else{\n                                            Span(Class:text-danger, Body: LangRes(empty))\n                                        }\n                                    }\n                                    Div(list-group-item t6 text-muted){\n                                        If(#subject_id# > 0){\n                                            Hash: #subject_subject_hash#\n                                        }.Else{\n                                            Hash: LangRes(empty)\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-12){\n                                    If(And(#isStarted#<0,#instance_voting_type#==1)){\n                                        Button(Class: btn btn-link, Page: voting_decision_document, PageParams: \"vID=#vID#\"){\n                                            Strong(LangRes(subject_voting_edit))\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row mt-sm){\n                                Div(col-sm-8 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    If(#isVotingAllowed#==1){\n                                        Div(pull-left){\n                                            Button(Body: LangRes(reject), Class: btn btn-danger, Contract: voting_RejectDecision, PageParams: \"vID=#vID#\", Page: voting_view)\n                                        }\n                                        Div(pull-right){\n                                            Button(Body: LangRes(accept), Class: btn btn-success, Contract: voting_AcceptDecision, PageParams: \"vID=#vID#\", Page: voting_view)\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        If(#instance_voting_type_decision#==4){\n                            DBFind(Name: votings_subject, Source: src_voting_subject).Columns(\"id,subject->description,subject->table,subject->table_id,subject->column,subject->column_value\").Where(\"voting_id=#vID#\").Vars(subject)\n\n                            If(#instance_voting_type#==1){\n                                Div(row mt-sm t5){\n                                    Div(col-md-6 text-right){\n                                        LangRes(table_to_written)\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                    Div(col-md-6 text-left){\n                                        If(#subject_id# > 0){\n                                            #subject_subject_table#\n                                        }.Else{\n                                            Span(Class:text-danger, Body: LangRes(empty))\n                                        }\n                                    }\n                                }\n                                Div(row mt-sm t5){\n                                    Div(col-md-6 text-right){\n                                        LangRes(row_id)\n                                        Span(Class: text-danger, Body:*)\n                                    }\n                                    Div(col-md-6 text-left){\n                                        If(#subject_id# > 0){\n                                            #subject_subject_table_id#\n                                        }.Else{\n                                            Span(Class:text-danger, Body: LangRes(empty))\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    If(#instance_voting_type#==1){\n                                        LangRes(column_name)\n                                    }.Else{\n                                        LangRes(parameter_name)\n                                    }\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#subject_id# > 0){\n                                        #subject_subject_column#\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(empty))\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    Span(Body: LangRes(written_value))\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left break){\n                                    If(#subject_id# > 0){\n                                        #subject_subject_column_value#\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(empty))\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(description)\n                                }\n                                Div(col-md-6 text-left break){\n                                    If(#subject_id# > 0){\n                                        If(#subject_subject_description# == \"\"){\n                                            Span(Class:text-muted, Body: LangRes(optional))\n                                        }.Else{\n                                            #subject_subject_description#\n                                        }\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(empty))\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-12){\n                                    If(And(#isStarted#<0,#instance_voting_type#==1)){\n                                        Button(Class: btn btn-link, Page: voting_decision_formal, PageParams: \"vID=#vID#\"){\n                                            Strong(LangRes(subject_voting_edit))\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row mt-sm){\n                                Div(col-sm-8 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    If(#isVotingAllowed#==1){\n                                        Div(pull-left){\n                                            Button(Body: LangRes(reject), Class: btn btn-danger, Contract: voting_RejectDecision, PageParams: \"vID=#vID#\", Page: voting_view)\n                                        }\n                                        Div(pull-right){\n                                            Button(Body: LangRes(accept), Class: btn btn-success, Contract: voting_AcceptDecision, PageParams: \"vID=#vID#\", Page: voting_view)\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        If(#instance_voting_type_decision#==5){\n                            DBFind(Name: votings_subject, Source: src_voting_subject).Columns(\"id,subject->contract_accept,subject->contract_reject\").Where(\"voting_id=#vID#\").Vars(subject)\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(contract_accept)\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#subject_id# > 0){\n                                        #subject_subject_contract_accept#\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(empty))\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-6 text-right){\n                                    LangRes(contract_reject)\n                                    Span(Class: text-danger, Body:*)\n                                }\n                                Div(col-md-6 text-left){\n                                    If(#subject_id# > 0){\n                                        #subject_subject_contract_reject#\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(empty))\n                                    }\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-12){\n                                    If(And(#isStarted#<0,#instance_voting_type#==1)){\n                                        Button(Class: btn btn-link, Page: voting_decision_contract, PageParams: \"vID=#vID#\"){\n                                            Strong(LangRes(subject_voting_edit))\n                                        }\n                                    }\n                                }\n                            }\n                            Div(row mt-sm){\n                                Div(col-sm-8 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    If(#isVotingAllowed#==1){\n                                        Div(pull-left){\n                                            Button(Body: LangRes(reject), Class: btn btn-danger, Contract: voting_RejectDecision, PageParams: \"vID=#vID#\", Page: voting_view)\n                                        }\n                                        Div(pull-right){\n                                            Button(Body: LangRes(accept), Class: btn btn-success, Contract: voting_AcceptDecision, PageParams: \"vID=#vID#\", Page: voting_view)\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n\n                    Div(list-group-item text-center t5){\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(status)\n                            }\n                            Div(col-md-6 text-left){\n                                If(#instance_flags_success#==1){\n                                    Span(Class:text-success, Body: LangRes(success))\n                                }.ElseIf(#isStarted#>0){\n                                    If(And(#instance_flags_full_data#==1,#instance_progress_number_participants#>0)){\n                                        If(#isEnded#>0){\n                                            Span(Class:text-muted, Body: LangRes(finished))\n                                        }.Else{\n                                            Span(Class:text-success, Body: LangRes(started))\n                                        }\n                                    }.Else{\n                                        Span(Class:text-danger, Body: LangRes(invalid))\n                                    }\n                                }.Else{\n                                    Span(Class:text-warning, Body: LangRes(waiting))\n                                }\n                                If(#instance_flags_full_data#==0){\n                                    Div(text-muted){LangRes(not_filled)}\n                                }\n                                If(#instance_progress_number_participants#==0){\n                                    Div(text-muted){LangRes(not_participants)}\n                                }\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(decision)\n                            }\n                            Div(col-md-6 text-left){\n                                If(#instance_flags_decision#==-2){\n                                    LangRes(not_enough_votes)\n                                }\n                                If(#instance_flags_decision#==-1){\n                                    Span(Class:text-danger, Body: LangRes(rejected))\n                                }\n                                If(#instance_flags_decision#==0){\n                                    LangRes(no)\n                                }\n                                If(#instance_flags_decision#==1){\n                                    Span(Class:text-success, Body: LangRes(accepted))\n                                }\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(date_start)\n                            }\n                            Div(col-md-6 text-left){\n                                If(#isStarted#>0){\n                                    Span(Class:text-muted, Body: DateTime(DateTime: #instance_date_started#, Format: \"DD.MM.YYYY HH:MI\"))\n                                }.Else{\n                                    DateTime(DateTime: #instance_date_started#, Format: \"DD.MM.YYYY HH:MI\")\n                                }\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(date_end)\n                            }\n                            Div(col-md-6 text-left){\n                                If(#isEnded#>0){\n                                    Span(Class:text-muted, Body: DateTime(DateTime: #instance_date_ended#, Format: \"DD.MM.YYYY HH:MI\"))\n                                }.Else{\n                                    DateTime(DateTime: #instance_date_ended#, Format: \"DD.MM.YYYY HH:MI\")\n                                }\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(voting_volume)\n                            }\n                            Div(col-md-6 text-left){\n                                #instance_voting_volume#\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(voting_quorum)\n                            }\n                            Div(col-md-6 text-left){\n                                #instance_voting_quorum#\n                            }\n                        }\n                        Div(row mt-sm){\n                            Div(col-md-6 text-right){\n                                LangRes(participants)\n                                Span(Class: text-danger, Body:*)\n                            }\n                            Div(col-md-6 text-left){\n                                If(#instance_progress_number_participants# > 0){\n                                    #instance_progress_number_participants#\n                                }.Else{\n                                    Span(Class:text-danger, Body: #instance_progress_number_participants#)\n                                }\n                            }\n                        }\n                        Div(row mt-sm t6){\n                            Div(col-sm-8 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                DBFind(Name: votings_participants, Source: src_voting_participants).Custom(custom_address){\n                                    Div(Class: t6 m0, Body: Address(#member.member_id#))\n                                }.Custom(custom_decision){\n                                    If(Or(#instance_voting_type_decision#==1,#instance_voting_type_decision#==2)){\n                                        If(#decision#==0){\n                                            LangRes(did_not_vote)\n                                        }.Else{\n                                            Div(Class: text-success text-center, Body: $vote_for_candidate$:)\n                                            Div(Class: text-success text-center, Body: Address(#decision#) )\n                                            Div(Class: text-success text-center, Body: $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                    }\n                                    If(#instance_voting_type_decision#==3){\n                                        If(#decision#==0){\n                                            LangRes(did_not_vote)\n                                        }\n                                        If(#decision#==1){\n                                            Span(Class: text-success, Body: $document_accept$ $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                        If(#decision#==-1){\n                                            Span(Class: text-danger, Body: $document_reject$ $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                    }\n                                    If(#instance_voting_type_decision#==4){\n                                        If(#decision#==0){\n                                            LangRes(did_not_vote)\n                                        }\n                                        If(#decision#==1){\n                                            Span(Class: text-success, Body: $decision_accept$ $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                        If(#decision#==-1){\n                                            Span(Class: text-danger, Body: $decision_reject$ $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                    }\n                                    If(#instance_voting_type_decision#==5){\n                                        If(#decision#==0){\n                                            LangRes(did_not_vote)\n                                        }\n                                        If(#decision#==1){\n                                            Span(Class: text-success, Body: $contract_accepted$ $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                        If(#decision#==-1){\n                                            Span(Class: text-danger, Body: $contract_rejected$ $at$ DateTime(DateTime: #decision_date#, Format: \"DD.MM.YYYY HH:MI\"))\n                                        }\n                                    }\n                                }.Order(\"id\").Columns(\"id,member->member_id,decision_date,decision\").Where(\"voting_id=#vID#\")\n                                Table(src_voting_participants, \"=custom_address,=custom_decision\")\n                            }\n                        }\n                        Div(row mt-sm t5){\n                            Div(col-md-12){\n                                If(And(#isStarted#<0,#instance_voting_type#==1)){\n                                    Button(Class: btn btn-link, Page: voting_invite, PageParams: \"vID=#vID#\"){\n                                        Strong(LangRes(participants_add))\n                                    }\n                                }\n                            }\n                        }\n                    }\n\n                    Div(list-group-item text-center){\n                        Div(row mt-sm t4){\n                            Div(col-md-5 col-md-offset-1){\n                                LangRes(voted)\n                            }\n                            Div(col-md-5){\n                                LangRes(progress)\n                            }\n                        }\n                        If(graph_work==\"good\"){\n                            Div(row mt-sm text-muted t6 text-center){\n                                Div(col-md-5 col-md-offset-1){\n                                    LangRes(voting_graph_voted)\n                                }\n                                Div(col-md-5){\n                                    LangRes(voting_graph_progress)\n                                }\n                            }\n                        }\n                        Div(row mt-sm text-center t3){\n                            Div(col-md-5 col-md-offset-1){\n                                #instance_progress_number_voters# LangRes(voters) / #instance_progress_percent_voters#% LangRes(voters)\n                            }\n                            Div(col-md-5){\n                                #instance_progress_percent_success#% LangRes(success) / 100% LangRes(total)\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(attention))\n        }\n    }\n}.Style(\n    .t3 {font-size:24px;}\n    .t4 {font-size:18px;}\n    .t5 {font-size:14px;}\n    .t6 {font-size:12px;}\n    .break {word-break: break-all;}\n)",
            "Name": "voting_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract NotificationsBroadcast {\n    data {\n        Header string\n        Body string\n        RoleId int\n    }\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"members\").Where(\"id=?\", kid).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        }else{\n            if DBFind(\"keys\").Columns(\"id\").Where(\"id=?\", kid).Row() {\n                res[\"member_id\"] = Str(kid)\n                res[\"member_name\"] = IdToAddress(kid)\n                res[\"image_id\"] = \"0\"\n            }\n        }\n        return res\n    }\n    conditions {\n        if $role_id !=1 {\n            error \"The action allowed only for admin\"\n        }\n        if $ecosystem_id!=1 {\n            error \"The action allowed only for admin from first ecosystem\"\n        }\n        $ecos = DBFind(\"ecosystems\").Ecosystem(1).Columns(\"id\")\n        $lenEcos = Len($ecos)\n        if $lenEcos == 1{\n            error \"Not found other ecosystems\"\n        }\n    }\n    action {\n        var i lenIds int eco map ids array table roleName string sender recipient params note map\n        roleName = DBFind(\"roles\").Where(\"id=?\", $role_id).One(\"role_name\")\n        sender = getMemberInfo($key_id)\n        sender[\"type\"] = \"1\"\n        \n        note[\"header\"] = $Header\n        note[\"type\"] = \"1\"\n        note[\"icon\"] = \"icon-envelope\"\n        note[\"body\"] = $Body\n\n        while i<$lenEcos{\n            eco = $ecos[i]\n            if eco[\"id\"] != 1{\n                ids = DBFind(\"roles_participants\").Where(\"role->id=? and role->type='3'\", $RoleId).Columns(\"member->member_id\")\n                lenIds = Len(ids)\n                table = Sprintf(\"@%v_notifications\", eco[\"id\"])\n                var i_ids int\n                while i_ids<lenIds{\n                    recipient = ids[i_ids]\n                    recipient = getMemberInfo(Int(recipient[\"member.member_id\"]))\n                    DBInsert(table, \"recipient,sender,notification,page_name,page_params,timestamp date_created\",\n                    recipient, sender, note, \"notifications_show\", params, $block_time)\n                    i_ids=i_ids+1\n                }\n            }\n            i=i+1\n        }\n    }\n}",
            "Name": "NotificationsBroadcast",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract ProfileEditAvatar {\n    data {\n        member_image bytes \"file\"\n    }\n\n    conditions {\n        var app_name string\n        app_name = \"Basic application\"\n\n        $member_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\n        $app_id = DBFind(\"applications\").Where(\"name = $ AND deleted = 0\", app_name).One(\"id\")\n\n        if !$member_map {\n            warning \"Member name is not specified\"\n        }\n    }\n\n    action {\n        var image_name string\n        image_name = \"avatar\"\n\n        var image_id int\n        if $member_map {\n            image_id = @1UploadBinary(\"Name,Data,ApplicationId\", image_name, $member_image, Int($app_id))\n            DBUpdate(\"members\", Int($member_map[\"id\"]), \"image_id\", image_id)\n        }\n    }\n}",
            "Name": "ProfileEditAvatar",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Profile_Edit {\n   data {\n       member_name string\n       information string \"optional\"\n   }\n\n   conditions {\n       var app_name string\n       app_name = \"Basic application\"\n\n       $member_map = DBFind(\"members\").Where(\"id = $\", $key_id).Row()\n       $app_id = DBFind(\"applications\").Where(\"name = $ AND deleted = 0\", app_name).One(\"id\")\n\n       if !$member_map {\n           // check member_name\n           $member_id = DBFind(\"members\").Where(\"member_name = $\", $member_name).One(\"id\")\n           if $member_id {\n               warning \"This member name is busy. Enter another member name, please\"\n           }\n       }\n   }\n\n   action {\n       var memberInfo map\n       memberInfo[\"information\"] = $information\n       if !$member_map{\n            DBInsert(\"members\", \"id,member_name,member_info\", $key_id, $member_name, memberInfo)\n       } else {\n            DBUpdate(\"members\", $key_id, \"member_info\", memberInfo)\n       }\n   }\n}",
            "Name": "Profile_Edit",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract RoleConditions {\n    data{\n        role string\n    }\n    conditions {\n        if !DBFind(\"roles_participants\").Where(\"role->name=? and member->member_id=? and deleted=0\", $role, $key_id).Row() {\n            warning Sprintf(\"This action allowed only for role: %v\", $role)\n        }\n    }\n}",
            "Name": "RoleConditions",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract notifications_Send {\n    data {\n        member_id int \"optional\"\n        rid int \"optional\"\n        closure_type int \"optional\"\n\n        sender int\n        icon_name string \"optional\"\n        text_header string\n        text_body string \"optional\"\n        page_name string\n        params_map string // json encoded expected\n    }\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"members\").Where(\"id=?\", kid).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        }else{\n            if DBFind(\"keys\").Columns(\"id\").Where(\"id=?\", kid).Row() {\n                res[\"member_id\"] = Str(kid)\n                res[\"member_name\"] = IdToAddress(kid)\n                res[\"image_id\"] = \"0\"\n            }\n        }\n        return res\n    }\n    func sendNotify(recipient map){\n        var notification map\n        notification[\"header\"] = $text_header\n        notification[\"type\"] = $notify_type\n        notification[\"icon\"] = $icon_name\n        notification[\"body\"] = $text_body\n        var sender map\n        if $sender == 1 && $senderMember {\n            // send from member\n            sender[\"type\"] = $sender\n            sender[\"member_id\"] = $senderMember[\"member_id\"]\n            sender[\"member_name\"] = $senderMember[\"member_name\"]\n            sender[\"image_id\"] = $senderMember[\"image_id\"]\n        }else{\n            if $sender == 2 && $senderRole{\n                // send from role\n                sender[\"type\"] = $sender\n                sender[\"role_id\"] = $senderRole[\"id\"]\n                sender[\"role_name\"] = $senderRole[\"role_name\"]\n                sender[\"image_id\"] = $senderRole[\"image_id\"]\n            }\n        }\n\n        DBInsert(\"notifications\", \"recipient,sender,notification,page_name,page_params,timestamp date_created\",\n        recipient, sender, notification, $page_name, $params_map, $block_time)\n    }\n\n    func sendToRole(roleId int){\n        var role recipient map\n        role = DBFind(\"roles\").Where(\"id=?\", roleId).Row()\n        recipient[\"role_id\"] = role[\"id\"]\n        recipient[\"role_name\"] = role[\"role_name\"]\n        recipient[\"image_id\"] = role[\"image_id\"]\n\n        sendNotify(recipient)\n    }\n\n    conditions {\n        $member_id = Int($member_id)\n        $rid = Int($rid)\n        if Size($icon_name) < 1{\n            $icon_name = \"icon-envelope\"\n        }\n        if $member_id != 0 {\n            if !DBFind(\"keys\").Where(\"id=?\", $member_id).Row(){\n                warning \"Key not found\"\n            }\n            $notify_type = 1 // is \"member\"\n        }else{\n            if $rid > 0{\n                $notify_type = 2 // is \"role\"\n                if !DBFind(\"roles\").Where(\"id=?\", $rid).One(\"id\") {\n                    warning $this_contract+\": Recipient role not found\"\n                }\n                if !DBFind(\"roles_participants\").Where(\"role->id=? and deleted=0\", $rid).One(\"id\") {\n                    warning $this_contract+\": Recipient role does not contain members\"\n                }\n            } else{\n                warning $this_contract+\": Notification type not defined\"\n            }\n        }\n        $senderMember = nil\n        $senderRole = nil\n        if $sender == 1 {\n            $senderMember = getMemberInfo($key_id)\n        }else{\n            if $sender == 2 {\n                $senderRole = DBFind(\"roles\").Where(\"id=?\", $role_id).Row()\n                if !$senderRole {\n                    warning $this_contract+\": Sender role not found\"\n                }\n            }else{\n                warning $this_contract+\": Sender invalid\"\n            }\n        }\n    }\n    action {\n        if $member_id != 0 {\n            sendNotify(getMemberInfo($member_id))\n        }else{\n            if $rid > 0 {\n                if $closure_type == 1 {\n                    // Single closure: one begins the process - the others do not see\n                    // Одиночное закрытие: все имеющие роль получают оповещение, но как только один из них запустит процесс работы с оповещением оно скроется от остальных\n                    sendToRole($rid)\n                } else {\n                    // Multiple closure: to each his own notification\n                    // Множественное закрытие: каждый участник роли получает свое одиночное оповещение\n                    $notify_type = 1\n                    var participants array\n                    participants = DBFind(\"roles_participants\").Columns(\"member->member_id\").Where(\"role->id=? and deleted=0\", $rid)\n                    var i int\n                    while i < Len(participants) {\n                        var p map\n                        p = participants[i]\n                        sendNotify(getMemberInfo(Int(p[\"member.member_id\"])))\n                        i=i+1\n                    }\n                }\n            }\n        }\n    }\n}",
            "Name": "notifications_Send",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract notifications_Process {\n    data {\n        notific_id int\n    }\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"members\").Where(\"id=?\", kid).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        }else{\n            member = DBFind(\"keys\").Where(\"id=?\", kid).Row()\n            if member {\n                res[\"member_id\"] = member[\"id\"]\n                res[\"member_name\"] = IdToAddress(Int(member[\"id\"]))\n                res[\"image_id\"] = 0\n            }\n        }\n        return res\n    }\n    conditions {\n        $notify = DBFind(\"notifications\").Columns(\"recipient->role_id,sender->type,date_start_processing\").Where(\"id=?\", $notific_id).Row()\n        if !$notify {\n            warning \"Notification not found\"\n        }\n\n        if $notify[\"sender.type\"] == 2{\n            if $notify[\"date_start_processing\"] != \"\" {\n                warning \"Sorry, processing of this notification has already begun\"\n            }\n            if !DBFind(\"roles_participants\").Where(\"role->id=? and member->member_id=? and deleted=0\", Int($notify[\"recipient.role_id\"]), $key_id).One(\"id\") {\n                warning \"Sorry, you are not part of the role for which this notification is intended\"\n            }\n        }else{\n            if $notify[\"sender.type\"] != 1 {\n                warning \"Notification type not found\"\n            }\n        }\n    }\n\n    action {\n        DBUpdate(\"notifications\", $notific_id, \"timestamp date_start_processing,processing_info\", $block_time, JSONEncode(getMemberInfo($key_id)))\n    }\n}",
            "Name": "notifications_Process",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_CheckAccess {\n    data {\n        rid int\n    }\n    conditions {\n        var role map\n        role = DBFind(\"roles\").Columns(\"id,role_name,deleted,roles_access->rids,role_type,creator->member_id,company_id\").Where(\"id=?\", $rid).Row()\n        if !role {\n            warning Sprintf(\"%v: Role not found\", $this_contract)\n        }\n        \n        if role[\"creator.member_id\"] == $key_id {\n            return\n        }\n\n        var rids rawRids array, i int\n        rawRids = Split(role[\"roles_access.rids\"], \",\")\n        while i < Len(rawRids){\n            if rawRids[i] > 0 {\n                rids = Append(rids, rawRids[i])\n            }\n            i=i+1\n        }\n        i=0\n        while i<Len(rids){\n            if rids[i] == $role_id {\n                return\n            }\n            i=i+1\n        }\n\n        if role[\"role_type\"] == 4 {\n            // company role\n            if role[\"company_id\"] == $key_id {\n                return\n            }else{\n                warning \"Sorry, you are not the creator of this company\"\n            }\n        }\n        warning Sprintf(\"Sorry, you don't have permission to change this role (%q)\", role[\"role_name\"])\n    }\n}",
            "Name": "Roles_CheckAccess",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_AccessManager {\n    data {\n        Action string\n        Rid int\n        ManagerRid string \"optional\"\n    }\n    func updateAccess(ra string){\n        var roles_access map\n        roles_access[\"rids\"] = ra\n        DBUpdate(\"roles\", $Rid, \"roles_access\", roles_access)\n    }\n    conditions {\n        Roles_CheckAccess(\"rid\", $Rid)\n\n        $ManagerRid = Int($ManagerRid)\n        $role = DBFind(\"roles\").Columns(\"id,roles_access->rids\").Where(\"id=?\", $Rid).Row()\n        if !$role {\n            warning \"Role not found\"\n        }\n        if $ManagerRid > 0{\n            if !DBFind(\"roles\").Where(\"id=?\", $ManagerRid).One(\"id\") {\n                warning \"Role not found\"\n            }\n        }\n        var ids array, i int\n        $ids = ids\n        ids = Split($role[\"roles_access.rids\"],\",\")\n        while i < Len(ids){\n            if ids[i] > 0 {\n                $ids = Append($ids, ids[i])\n            }\n            i=i+1\n        }\n    }\n\n    action {\n        if $Action == \"clean\"{\n            updateAccess(\"\")\n        }\n        if $ManagerRid > 0{\n            var i int, idsNew array\n            if $Action == \"remove\"{\n                while i<Len($ids){\n                    if $ids[i] != $ManagerRid{\n                        idsNew = Append(idsNew, $ids[i])\n                    }\n                    i=i+1\n                }\n                updateAccess(Join(idsNew, \",\"))\n            }\n            if $Action == \"add\"{\n                var double bool\n                while i<Len($ids){\n                    if $ids[i] == $ManagerRid{\n                        double = true\n                    }\n                    i=i+1\n                }\n                if !double {\n                    $ids = Append($ids, $ManagerRid)\n                }\n                updateAccess(Join($ids, \",\"))\n            }\n        }\n    }\n}",
            "Name": "Roles_AccessManager",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_Assign {\n    data {\n        rid int\n        member_id int\n    }\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"members\").Where(\"id=?\", kid).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        }else{\n            member = DBFind(\"keys\").Where(\"id=?\", kid).Row()\n            if member {\n                res[\"member_id\"] = member[\"id\"]\n                res[\"member_name\"] = IdToAddress(Int(member[\"id\"]))\n                res[\"image_id\"] = 0\n            }\n        }\n        return res\n    }\n    conditions {\n        $role = DBFind(\"roles\").Columns(\"id,deleted,role_type,role_name,image_id,creator->member_id\").Where(\"id=?\", $rid).Row()\n        if !$role {\n            warning \"Role not found\"\n        }\n        \n        if !DBFind(\"keys\").Where(\"id=?\", $member_id).Row() {\n            warning \"Key not found\"\n        }\n\n        if $role[\"deleted\"] == 1 {\n            warning \"This role has been deleted. The appointment of members is impossible\"\n        }\n\n        var specialRules map prev_contract string stack array\n        stack = JSONDecode(JSONEncode($stack))\n        prev_contract = stack[0]\n        if Len(stack)>2{\n            prev_contract = stack[Len(stack)-2]\n        }\n        specialRules[\"@1sysparams_AcceptValidator\"] = \"Validator\"\n        specialRules[\"@1sysparams_DelegateRefresh\"] = \"Delegate\"\n        specialRules[\"@1sysparams_CandidateValidatorRequest\"] = \"Candidate for validators\"\n        specialRules[\"@1voting_TemplateRun\"] = \"Investor with voting rights\"\n        specialRules[\"@1tokenrefund_Start\"] = \"Investor with voting rights\"\n        if specialRules[prev_contract] != $role[\"role_name\"] {\n            Roles_CheckAccess(\"rid\", $rid)\n        }\n\n        $assigned = DBFind(\"roles_participants\").Where(\"role->id=? and member->member_id=? and deleted=0\", $rid, $member_id).One(\"id\")\n    }\n\n    action {\n        if $assigned {\n            // do not re-assign and do not warning because this contract may be called for other\n            return\n        }\n        var role member appointer map\n        role[\"id\"] = $role[\"id\"]\n        role[\"type\"] = $role[\"role_type\"]\n        role[\"name\"] = $role[\"role_name\"]\n        role[\"image_id\"] = $role[\"image_id\"]\n\n        member = getMemberInfo($member_id)\n        appointer = getMemberInfo($key_id)\n\n        DBInsert(\"roles_participants\", \"role,member,appointed,timestamp date_created\", role, member, appointer, $block_time)\n    }\n}",
            "Name": "Roles_Assign",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_Create {\n    data {\n        role_name string\n        role_type int\n    }\n   func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"members\").Where(\"id=?\", kid).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        }else{\n            member = DBFind(\"keys\").Where(\"id=?\", kid).Row()\n            if member {\n                res[\"member_id\"] = member[\"id\"]\n                res[\"member_name\"] = IdToAddress(Int(member[\"id\"]))\n                res[\"image_id\"] = 0\n            }\n        }\n        return res\n    }\n\t\n    conditions {\n        // system role\n        if $role_type == 3 {\n            warning \"System role can not be created\"\n        }\n    }\n\n    action {\n        var creator map\n        creator = getMemberInfo($key_id)\n        $result = DBInsert(\"roles\", \"role_name,role_type,creator,timestamp date_created,company_id\", $role_name, $role_type, creator, $block_time, 0)\n    }\n}",
            "Name": "Roles_Create",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_Unassign {\n    data {\n        row_id int\n    }\n\n    conditions {\n        // check record\n        var assigned role map\n        assigned = DBFind(\"roles_participants\").Columns(\"id,role->id\").Where(\"id=$\", $row_id).Row()\n        if !assigned {\n            warning \"Participant not found\"\n        }\n\n        role = DBFind(\"roles\").Columns(\"id,creator->member_id,role_name\").Where(\"id=?\", assigned[\"role.id\"]).Row()\n        if !role {\n            warning \"Role not found in the roles registry\"\n        }\n\n        var specialRules map prev_contract string stack array\n        stack = JSONDecode(JSONEncode($stack))\n        prev_contract = stack[0]\n        if Len(stack)>2{\n            prev_contract = stack[Len(stack)-2]\n        }\n        specialRules[\"@1sysparams_AcceptValidator\"] = \"Candidate for validators\"\n        specialRules[\"@1sysparams_DelegateRefresh\"] = \"Delegate\"\n        specialRules[\"@1sysparams_CandidateValidatorRequest\"] = \"Candidate for validators\"\n        specialRules[\"@1sysparams_InvestorRefresh\"] = \"Investor with voting rights\"\n        specialRules[\"@1tokenrefund_Start\"] = \"Investor with voting rights\"\n        specialRules[\"@1sysparams_ValidatorResign\"] = \"Validator\"\n\n        if specialRules[prev_contract] != role[\"role_name\"] {\n            Roles_CheckAccess(\"rid\", Int(role[\"id\"]))\n        }\n    }\n\n    action {\n        // delete the member\n        DBUpdate(\"roles_participants\", $row_id, \"deleted,timestamp date_deleted\", 1, $block_time)\n    }\n}",
            "Name": "Roles_Unassign",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_Restore {\n    data {\n        rid int\n    }\n    \n    conditions {        \n        Roles_CheckAccess(\"rid\", $rid)\n    }\n    \n    action {\n        DBUpdate(\"roles\", $rid, \"deleted\", 0)\n    }\n}",
            "Name": "Roles_Restore",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract Roles_Del {\n    data {\n        rid int\n    }\n\n    conditions {\n        Roles_CheckAccess(\"rid\", $rid)\n    }\n\n    action {\n        var participants array\n        participants = DBFind(\"roles_participants\").Columns(\"id\").Where(\"role->id=? and deleted=0\", $rid)\n\n        // delete all participants\n        var i int\n        while i < Len(participants) {\n            var p map\n            p = participants[i]\n            Roles_Unassign(\"row_id\", Int(p[\"id\"]))\n            i = i + 1\n        }\n\n        DBUpdate(\"roles\", $rid, \"deleted,timestamp date_deleted\", 1, $block_time)\n    }\n}",
            "Name": "Roles_Del",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract TokenTransfer {\n    data {\n        Amount money\n        Sender_AccountId int\n        Recipient_AccountId int\n        Comment string \"optional\"\n        //Signature string \"optional hidden\"\n    }\n    \n    conditions {\n        //check amount\n        if $Amount == 0 {\n            error \"Amount is zero\"\n        }\n        if $Amount < 0 {\n            error \"Amount is negative\"\n        }\n        \n        //check the sender\n        var sender string\n        sender = DBFind(\"keys\").Where(\"id=$\", $Sender_AccountId).One(\"id\")\n        if !sender {\n            error Sprintf(\"Sender %v is invalid\", $Sender_AccountId)\n        }\n        \n        //check balance\n        $sender_balance = Money(DBFind(\"keys\").Where(\"id=$\", $Sender_AccountId).One(\"amount\"))\n        if $Amount > $sender_balance {\n            error Sprintf(\"Money is not enough %v < %v\", $sender_balance, $Amount)\n        }\n        \n        //check the recipient\n        var recipient string\n        recipient = DBFind(\"keys\").Where(\"id=$\", $Recipient_AccountId).One(\"id\")\n        if !recipient {\n            error Sprintf(\"Recipient %v is invalid\", $Recipient_AccountId)\n        }\n    }\n    \n    action {\n        DBUpdate(\"keys\", $Sender_AccountId, \"-amount\", $Amount)\n        DBUpdate(\"keys\", $Recipient_AccountId, \"+amount\", $Amount)\n        DBInsert(\"history\", \"sender_id,recipient_id,amount,comment,block_id,txhash\", $Sender_AccountId, $Recipient_AccountId, $Amount, $Comment, $block, $txhash)\n    }\n}",
            "Name": "TokenTransfer",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract SendTokens {\n    data {\n        Amount money\n        Recipient_Account string\n        //Signature string \"signature:TokenTransfer\"\n    }\n\n    conditions {\n        $recipient = AddressToId($Recipient_Account)\n        if $recipient == 0 {\n            error Sprintf(\"Recipient %v is invalid\", $Recipient_Account)\n        }\n    }\n\n    action {\n        //TokenTransfer(\"Amount,Sender_AccountId,Recipient_AccountId,Signature\", $Amount, $key_id, $recipient, $Signature)\n        TokenTransfer(\"Amount,Sender_AccountId,Recipient_AccountId\", $Amount, $key_id, $recipient)\n    }\n}",
            "Name": "SendTokens",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract buffer_Manager {\n    data {\n        Action string\n        Key string\n        Val string \"optional\"\n    }\n    func decodeArray(s string) array{\n        var ar array\n        if HasPrefix($buf[\"value\"], \"[\") && Substr($buf[\"value\"], Size($buf[\"value\"])-1, 1) == \"]\"{\n            ar = JSONDecode($buf[\"value\"])\n        }\n        return ar\n    }\n    conditions {\n        $emptyVal = JSONEncode(\"\")\n        $buf = DBFind(\"buffer_data\").Where(\"key=? and member_id=?\", $Key, $key_id).Row()\n        if !$buf {\n            var buf map, id int\n            id = DBInsert(\"buffer_data\", \"key,value,member_id\", $Key, $emptyVal, $key_id)\n            buf[\"id\"] = Str(id)\n            buf[\"value\"] = \"\"\n            buf[\"member_id\"] = Str($key_id)\n            buf[\"key\"] = Str($Key)\n            $buf = buf\n        }\n    }\n\n    action {\n        if $Action == \"clean\" {\n            DBUpdate(\"buffer_data\", Int($buf[\"id\"]), \"value\", $emptyVal)\n        }\n        if $Action == \"set\" {\n            DBUpdate(\"buffer_data\", Int($buf[\"id\"]), \"value\", $Val)\n        }\n        if $Action == \"array_add_value\" {\n            var ar array\n            ar = decodeArray($buf[\"value\"])\n            ar[Len(ar)] = $Val\n            DBUpdate(\"buffer_data\", Int($buf[\"id\"]), \"value\", JSONEncode(ar))\n        }\n        if $Action == \"array_remove_value\" {\n            var ar arNew array, i int\n            ar = decodeArray($buf[\"value\"])\n            while i<Len(ar){\n                if ar[i] != $Val{\n                    arNew[Len(arNew)] = ar[i]\n                }\n                i=i+1\n            }\n            DBUpdate(\"buffer_data\", Int($buf[\"id\"]), \"value\", JSONEncode(arNew))\n        }\n    }\n}\n",
            "Name": "buffer_Manager",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract notifications_Close {\n    data {\n        notific_id int\n    }\n\n    conditions {\n        $notify = DBFind(\"notifications\").Columns(\"id,date_start_processing,processing_info->member_id,closed,sender->type\").Where(\"id=$\", $notific_id).Row()\n        if !$notify {\n            warning \"Notification not found\"\n        }\n        if $notify[\"sender.type\"] == 2{\n            //role has processing check\n            if $notify[\"date_start_processing\"] == \"\" {\n                warning \"Sorry, processing of this notification has not yet begun\"\n            }\n\n            if $notify[\"processing_info.member_id\"] != $key_id {\n                warning \"Sorry, processing of this notice began another member\"\n            }\n\n            if $notify[\"closed\"] > 0 {\n                warning \"Sorry, this notification has already been closed before\"\n            }\n        }else {\n            if $notify[\"sender.type\"] != 1 { // not single\n                warning \"Notification type not found\"\n            }\n        }\n    }\n\n    action {\n        if $notify[\"sender.type\"] == 1{\n            notifications_Process(\"notific_id\", $notific_id)\n        }\n\n        DBUpdate(\"notifications\", $notific_id, \"timestamp date_closed,closed\", $block_time, 1)\n    }\n}",
            "Name": "notifications_Close",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract RolesRequestDecision {\n    data {\n        decision int\n        notific_id int\n        rid int \"optional\"\n        member_id int \"optional\"\n    }\n\n    conditions {\n    }\n    \n    action {\n        if ($decision == 1){\n            Roles_Assign(\"rid,member_id\", $rid, $member_id)\n        }\n        \n        if ($notific_id > 0){\n            notifications_Close(\"notific_id\", $notific_id)\n        }\n    }\n}",
            "Name": "RolesRequestDecision",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract RolesRequest {\n    data {\n        rid int\n    }\n\n    conditions {\n        $role = DBFind(\"roles\").Where(\"id=?\", $rid).One(\"id\")\n        if !$role {\n            warning \"Role not found\"\n        }\n\n        $assigned = DBFind(\"roles_participants\").Where(\"role->id=? and member->member_id=? and deleted=0\", $rid, $key_id).One(\"id\")\n        if $assigned {\n            warning \"You have already been added to the role\"\n        }\n\n        $notifications = DBFind(\"notifications\").Where(\"page_name=? and page_params->rid=? and sender->member_id=? and closed=0\", \"roles_request_view\", $rid, $key_id).One(\"id\")\n        if $notifications {\n            warning \"Request already sent\"\n        }\n    }\n    \n    action {\n        var params map\n        params[\"rid\"] = $rid\n        \n        var member_id int\n        member_id = EcosysParam(\"founder_account\") \n\n        notifications_Send(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map\", \n            member_id, 1, \"fa-bars\", \"Roles\", \"New request received\", \"roles_request_view\", JSONEncode(params))\n    }\n}",
            "Name": "RolesRequest",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_CheckDecision {\n    data {\n        votingID int\n    }\n    func runContract(cont, p string){\n        if Size(cont) > 0 {\n            var params map\n            if Size(p) > 0 {\n                params = JSONToMap(p)\n            }\n            CallContract(cont, params)\n        }\n    }\n    func percentPartOfTotal(part, total int) int {\n        if total == 0{ total = 1 }\n        var percent int\n        percent = Int((part * 100)/total)\n        if percent > 100 { percent = 100 }\n        return percent\n    }\n    func closeNotes(){\n        var notes array\n        notes = DBFind(\"notifications\").Where(\"page_name='voting_view' and page_params->voting_id=?\", $votingID)\n        var i int\n        while i < Len(notes){\n            var note map\n            note = notes[i]\n            var noteId int\n            noteId = Int(note[\"id\"])\n            notifications_Close(\"notific_id\", noteId)\n            i=i+1\n        }\n    }\n    conditions {\n        $voting_map = DBFind(\"votings\").Columns(\"voting->name,voting->type,voting->quorum,voting->type_decision,flags->success,progress->number_voters,optional->role_id,optional->role_vacancies,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Where(\"id=? and (CAST(progress->percent_voters as INTEGER)>=CAST(voting->quorum as INTEGER) or date_ended<?)\", $votingID, BlockTime()).Row()\n        if !$voting_map {\n            warning \"Voting has not expired. Try again later, please\"\n        }\n\n        $subject_id = DBFind(\"votings_subject\").Where(\"voting_id=$\", $votingID).One(\"id\")\n        if !$subject_id {\n            warning \"Subject of voting is not found\"\n        }\n\n        $voting_name = $voting_map[\"voting.name\"]\n        $voting_type = Int($voting_map[\"voting.type\"]) //system or custom\n        $quorum = Int($voting_map[\"voting.quorum\"])\n        $type_decision = Int($voting_map[\"voting.type_decision\"])\n        $optional_role_id = Int($voting_map[\"optional.role_id\"])\n        $number_role_vacancies = Int($voting_map[\"optional.role_vacancies\"])\n        $number_voters = Int($voting_map[\"progress.number_voters\"]) // already voted\n        $contract_accept = $voting_map[\"optional.contract_accept\"]\n        $contract_reject = $voting_map[\"optional.contract_reject\"]\n        $param_accept = $voting_map[\"optional.contract_accept_params\"]\n        $param_reject = $voting_map[\"optional.contract_reject_params\"]\n        $flag_success = $voting_map[\"flags.success\"]\n    }\n\n    action {\n        // if notifications have been sent, then close it\n        var notes array\n        notes = DBFind(\"notifications\").Where(\"page_name='voting_view' and page_params::jsonb->voting_id=? and closed=0\", $votingID)\n        var i int\n        while i < Len(notes) {\n            var note map\n            note = notes[i]\n            notifications_Close(\"notific_id\", Int(note[\"id\"]))\n            i = i + 1\n        }\n\n        var percent_voters, flag_decision int\n        flag_decision = -2 // decision can not be made (not enough participants to make a decision)\n        if $flag_success == 1 { //now enough participants to make a decision\n\n            if $type_decision == 1 || $type_decision == 2 {\n                var candidates_added_count int\n                candidates_added_count = 0 // candidates who have already been added\n                flag_decision = -1 // none of the candidates has been added yet\n\n                var subjects array\n                subjects = DBFind(\"votings_subject\").Columns(\"voting_id,number_accept,subject->member_id,subject->member_name,subject->image_id\").Where(\"voting_id=$\", $votingID).Order(\"number_accept DESC\")\n                i = 0\n                while i < Len(subjects) {\n                    var subject map\n                    subject = subjects[i]\n\n                    // if there are still vacancies\n                    if candidates_added_count < $number_role_vacancies {\n                        percent_voters = percentPartOfTotal(Int(subject[\"number_accept\"]), $number_voters)\n\n                        if percent_voters >= $quorum {\n                            // added candidate to the role\n                            var role map\n                            role = DBFind(\"roles\").Columns(\"id,role_type,role_name,image_id\").Where(\"id=$\", $optional_role_id).Row()\n                            if role {\n                                var member, assignedMember map\n                                member[\"member_id\"] = subject[\"subject.member_id\"]\n                                assignedMember = DBFind(\"roles_participants\").Where(\"member->member_id=? and role->id=? and deleted=0\", member[\"member_id\"], role[\"id\"]).Row()\n\n                                if !assignedMember {\n                                    member[\"member_name\"] = subject[\"subject.member_name\"]\n                                    member[\"image_id\"] = subject[\"subject.image_id\"]\n\n                                    var rolePart map\n                                    rolePart[\"id\"] = role[\"id\"]\n                                    rolePart[\"type\"] = role[\"role_type\"]\n                                    rolePart[\"name\"] = role[\"role_name\"]\n                                    rolePart[\"image_id\"] = role[\"image_id\"]\n\n                                    var appointed map\n                                    appointed[\"voting_id\"] = $votingID\n                                    appointed[\"voting_name\"] = $voting_name\n\n                                    // add a candidate to the role\n                                    DBInsert(\"roles_participants\", \"role,member,appointed,timestamp date_created\", rolePart, member, appointed, $block_time)\n\n                                    candidates_added_count = candidates_added_count + 1\n                                    // if at least one of the candidates was added to the role, then the voting decision is considered successful\n                                    flag_decision = 1\n                                }\n                            }\n                        }\n                    }\n                    i = i + 1\n                }\n            }\n\n            if $type_decision == 3 {\n                var subject map\n                subject = DBFind(\"votings_subject\").Columns(\"id,number_accept\").Where(\"voting_id=$\", $votingID).Row()\n                if subject {\n                    percent_voters = percentPartOfTotal(Int(subject[\"number_accept\"]), $number_voters)\n                    if percent_voters >= $quorum {\n                        flag_decision = 1 // accepted\n                    } else {\n                        flag_decision = -1 // rejected\n                    }\n                }\n            }\n\n            if $type_decision == 4 {\n                var subject map\n                subject = DBFind(\"votings_subject\").Columns(\"id,number_accept,subject->table,subject->table_id,subject->column,subject->column_value\").Where(\"voting_id=$\", $votingID).Row()\n                if subject {\n                    percent_voters = percentPartOfTotal(Int(subject[\"number_accept\"]), $number_voters)\n                    if percent_voters >= $quorum {\n                        flag_decision = 1 // accepted\n\n                        var column string\n                        column = Str(subject[\"subject.column\"])\n                        $colValue = Str(subject[\"subject.column_value\"])\n                        // type of voting - custom\n                        if $voting_type == 1 {\n                            // ALWAYS CHECK THE PERMISSION\n                            var colType string\n                            colType = GetColumnType(subject[\"subject.table\"], column)\n                            if colType == \"number\"{\n                                $colValue = Int($colValue)\n                            }\n                            if colType == \"money\"{\n                                $colValue = Money($colValue)\n                            }\n                            if colType == \"double\" {\n                                $colValue = Float($colValue)\n                            }\n                            DBUpdate(subject[\"subject.table\"], Int(subject[\"subject.table_id\"]), column, $colValue)\n                        }\n\n                        // type of voting - system\n                        if $voting_type == 2 {\n                            @1UpdateSysParam(\"Name,Value,Conditions\", column, $colValue, \"\")\n                        }\n                    } else {\n                        flag_decision = -1 // rejected\n                    }\n                }\n            }\n\n            if $type_decision == 5 {\n                var subject map\n                subject = DBFind(\"votings_subject\").Columns(\"id,number_accept,subject->contract_accept,subject->contract_reject,subject->contract_accept_params,subject->contract_reject_params\").Where(\"voting_id=$\", $votingID).Row()\n                if subject {\n                    $contract_accept = subject[\"subject.contract_accept\"]\n                    $contract_reject = subject[\"subject.contract_reject\"]\n                    $param_accept = subject[\"subject.contract_accept_params\"]\n                    $param_reject = subject[\"subject.contract_reject_params\"]\n\n                    percent_voters = percentPartOfTotal(Int(subject[\"number_accept\"]), $number_voters)\n                    if percent_voters >= $quorum {\n                        flag_decision = 1 // accepted\n                    } else {\n                        flag_decision = -1 // rejected\n                    }\n                }\n            }\n\n            if flag_decision == 1 {\n                runContract($contract_accept, $param_accept)\n                closeNotes()\n            }\n            if flag_decision == -1 {\n                runContract($contract_reject, $param_reject)\n                closeNotes()\n            }\n        }\n\n        DBUpdate(\"votings\", $votingID, \"flags->decision\", flag_decision)\n    }\n}",
            "Name": "voting_CheckDecision",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_UpdateDataForGraphs {\n    data {\n        votingID int\n    }\n    \n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n  \n    func percentPartOfTotal(part, total int) int {\n        if total == 0{ total = 1 }\n        var percent int\n        percent = Int((part * 100)/total)\n        if percent > 100 { percent = 100 }\n        return percent\n    }\n    \n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"flags,voting,progress\").Where(\"id=?\", $votingID).Row()\n        if !$voting {\n            warning \"Voting is not found\"\n        }\n    }\n    \n    action {\n        var progress voting map\n        progress = safeJsonToMap($voting[\"progress\"])\n        voting = safeJsonToMap($voting[\"voting\"])\n        \n        var flag_success percent_success percent_voters number_voters quorum  volume int\n        // increment count of voters\n        quorum = Int(voting[\"quorum\"])\n        volume = Int(voting[\"volume\"])\n        number_voters = Int(progress[\"number_voters\"]) + 1\n        percent_voters = percentPartOfTotal(number_voters, Int(progress[\"number_participants\"]))\n        percent_success = percentPartOfTotal(percent_voters, volume)\n        \n        // update the flag of success\n        if percent_success == 100 {\n            flag_success = 1\n        }\n        progress[\"percent_voters\"] = percent_voters\n        progress[\"percent_success\"] = percent_success\n        progress[\"number_voters\"] = number_voters\n        \n        DBUpdate(\"votings\", $votingID, \"progress,flags->success\", progress, flag_success)\n        \n        if (percent_voters >= quorum && quorum > 50 && percent_voters >= volume) || percent_voters == 100 {\n            // if a quorum is more than 50% we can immediately make the decision\n            // OR\n            // if all participants have voted we can not wait until the end of the voting period\n            \n            voting_CheckDecision(\"votingID\", $votingID)\n        }\n    }\n}",
            "Name": "voting_UpdateDataForGraphs",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_AcceptCandidates {\n    data {\n        votingID int\n        candidateID int\n    }\n    \n    conditions {\n        $voting_map = DBFind(\"votings\").Columns(\"id,flags\").Where(\"id=?\", $votingID).Row()\n        if !$voting_map {\n            warning \"Voting is not found\"\n        }\n        \n        $subject_map = DBFind(\"votings_subject\").Where(\"voting_id=$ and subject->member_id=$\", $votingID, $candidateID).Row()\n        if !$subject_map {\n            warning \"Subject of voting is not found\"\n        }\n        \n        $participant_id = DBFind(\"votings_participants\").Where(\"voting_id=$ and member->member_id=$\", $votingID, $key_id).One(\"id\")\n        if !$participant_id {\n            warning \"You are not a participant in this voting\"\n        }\n    }\n    \n    action {\n        var flags map\n        flags = JSONToMap($voting_map[\"flags\"])\n        // if notifications have been sent, then close it\n        if flags[\"notifics\"] == 1 {\n            \n            $notific_id = DBFind(\"notifications\").Where(\"recipient->member_id=$ and page_name=$ and page_params->voting_id=$ and closed=$\", $key_id, \"voting_view\", $votingID, 0).One(\"id\")\n            \n            if $notific_id {\n                notifications_Close(\"notific_id\", Int($notific_id))\n            }\n        }\n        \n        // check the decision\n        if flags[\"decision\"] == 1 {\n            warning \"Decision was taken. Voting is now not possible\"\n        }\n        \n        // check start-end of voting time\n        var voting_start, voting_end string\n        voting_start = DBFind(\"votings\").Where(\"id=$ and date_started < $\", $votingID, BlockTime()).One(\"id\")\n        voting_end = DBFind(\"votings\").Where(\"id=$ and date_ended > $\", $votingID, BlockTime()).One(\"id\")\n        if !voting_start {\n            warning \"Voting has not yet begun. Try again later, please\"\n        }\n        if !voting_end {\n            warning \"Voting has expired. Voting is now not possible\"\n        }\n        \n        // write the result of the voting\n        DBUpdate(\"votings_participants\", Int($participant_id), \"timestamp decision_date,decision\", $block_time, $candidateID)\n        \n        // increment count of accept\n        DBUpdate(\"votings_subject\", Int($subject_map[\"id\"]), \"+number_accept\", 1)\n        \n        voting_UpdateDataForGraphs(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_AcceptCandidates",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SendNotifics {\n    data {\n        votingID int\n    }\n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"id,date_ended\").Where(\"id=$ and date_ended > $\", $votingID, BlockTime()).One(\"id\")\n        if !$voting {\n            warning \"Voting has expired. Notifications can not be sent\"\n        }\n        \n        $voting = DBFind(\"votings\").Columns(\"voting->name,creator->member_id,flags->notifics,flags,date_started\").Where(\"id=? and date_started > ?\", $votingID, BlockTime()).Row()\n        if !$voting {\n            warning \"Voting has not yet begun. Try again later, please\"\n        }\n        if $voting[\"creator.member_id\"] != $key_id {\n            warning \"You are not the creator of the voting\"\n        }\n        if $voting[\"flags.notifics\"] == 1 {\n            warning \"Notifications have already been sent\"\n        }\n        \n        $voting_name = $voting[\"voting.name\"]\n    }\n    \n    action {\n        var participants array\n        participants = DBFind(\"votings_participants\").Where(\"voting_id=? and decision=0\", $votingID)\n        var i int\n        while i < Len(participants) {\n            var participant member params map\n            participant = participants[i]\n            member = safeJsonToMap(participant[\"member\"])\n            params[\"voting_id\"] = $votingID\n            notifications_Send(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map,rid,closure_type\", Int(member[\"member_id\"]), 1, \"fa-check\", \"Voting\", $voting_name, \"voting_view\", JSONEncode(params), 0, 0)\n            \n            i = i + 1\n        }\n        \n        DBUpdate(\"votings\", $votingID, \"flags->notifics\", 1)\n    }\n}",
            "Name": "voting_SendNotifics",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_Delete {\n    data {\n        votingID int\n    }\n\n    conditions {\n        var voting map\n        voting = DBFind(\"votings\").Columns(\"id\").Where(\"id=? and creator->member_id=? and (date_started>? or progress->number_participants='0' or flags->full_data='0')\", $votingID, $key_id, BlockTime()).Row()\n        if !voting {\n            warning \"Delete voting impossible\"\n        }\n    }\n\n    action {\n        DBUpdate(\"votings\", $votingID, \"deleted\", 1)\n        var notes array\n        notes = DBFind(\"notifications\").Where(\"page_name='voting_view' and page_params->voting_id=?\", $votingID)\n        var i int\n        while i < Len(notes){\n            var note map noteId int\n            note = notes[i]\n            noteId = Int(note[\"id\"])\n            notifications_Close(\"notific_id\", noteId)\n            i=i+1\n        }\n    }\n}",
            "Name": "voting_Delete",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_Invite {\n    data {\n        votingID int\n        var_id int //0, member_id, role_id\n    }\n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n    func addVotingKey(key map, votingId int) {\n        var m map\n        m[\"member_id\"] = key[\"id\"]\n        m[\"member_name\"] = IdToAddress(Int(key[\"id\"]))\n        DBInsert(\"votings_participants\", \"voting_id,member\", votingId, m)\n    }\n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"progress,progress->number_participants,voting->type_participants,voting->type,id,date_ended\").Where(\"id=$ and date_ended > $\", $votingID, BlockTime()).Row()\n        if !$voting {\n            warning \"Voting has expired. Can not add new participants\"\n        }\n\n        $type_participants = $voting[\"voting.type_participants\"]\n        $type_voting = $voting[\"voting.type\"]\n        $number_participants = Int($voting[\"progress.number_participants\"])\n\n        if $number_participants > 1 && $type_voting == 2 {\n            warning \"This vote is a system. Add new participants are not possible\"\n        }\n        var isAdded string\n        if $type_participants == 2 {\n            if !DBFind(\"keys\").Where(\"id=?\", $var_id).Row(){\n                warning \"Key not found\"\n            }\n            isAdded = DBFind(\"votings_participants\").Where(\"voting_id=$ and member->member_id=$\", $votingID, $var_id).One(\"id\")\n            if isAdded {\n                warning \"Member has already been added before\"\n            }\n        }\n\n        if $type_participants == 3 {\n            isAdded = DBFind(\"votings_participants\").Where(\"voting_id=$\", $votingID).One(\"id\")\n            if isAdded {\n                warning \"Voting participants have already been added before\"\n            }\n            if Len(DBFind(\"roles_participants\").Where(\"role->id=? and deleted=0\", $var_id)) == 0 {\n                warning \"Roles participants not found\"\n            }\n        }\n    }\n\n    action {\n        var i int\n        if $type_participants == 1 { // everybody\n            var keys array\n            keys = DBFind(\"keys\")\n            while i < Len(keys) {\n                addVotingKey(keys[i], $votingID)\n                $number_participants = $number_participants + 1\n                i = i + 1\n            }\n        }\n        if $type_participants == 2 { // manual\n            var key map\n            key = DBFind(\"keys\").Where(\"id=?\", $var_id).Row()\n            addVotingKey(key, $votingID)\n            $number_participants = $number_participants + 1\n        }\n        if $type_participants == 3 { // role\n            var roles array\n            roles = DBFind(\"roles_participants\").Where(\"role->id=$ and deleted=0\", $var_id).Order(\"id\")\n            while i < Len(roles) {\n                var role map\n                role = roles[i]\n                DBInsert(\"votings_participants\", \"voting_id,member\", $votingID, role[\"member\"])\n                $number_participants = $number_participants + 1\n                i = i + 1\n            }\n        }\n\n        if $type_participants == 3 {\n            DBUpdate(\"votings\", $votingID, \"progress->number_participants,voting->role_id\", $number_participants, $var_id)\n        }else{\n            DBUpdate(\"votings\", $votingID, \"progress->number_participants\", $number_participants)\n        }\n        voting_SendNotifics(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_Invite",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_AcceptDecision {\n    data {\n        votingID int\n    }\n\n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"id,flags->decision,flags->notifics,voting->type_participants,voting->role_id\").Where(\"id=?\", $votingID).Row()\n        if !$voting {\n            warning \"Voting is not found\"\n        }\n        if $voting[\"voting.type_participants\"] == 3{\n            if $voting[\"voting.role_id\"] != $role_id{\n                warning \"Incorrect role for voting\"\n            }\n        }\n\n        $subject = DBFind(\"votings_subject\").Where(\"voting_id=$\", $votingID).Row()\n        if !$subject {\n            warning \"Subject of voting is not found\"\n        }\n\n        $participant_id = DBFind(\"votings_participants\").Where(\"voting_id=$ and member->member_id=$\", $votingID, $key_id).One(\"id\")\n        if !$participant_id {\n            warning \"You are not a participant in this voting\"\n        }\n    }\n\n    action {\n        // if notifications have been sent, then close it\n        if $voting[\"flags.notifics\"] == 1 {\n            var noteId string\n            noteId = DBFind(\"notifications\").Where(\"recipient->member_id=$ and page_name=$ and page_params->voting_id=$ and closed=$\", $key_id, \"voting_view\", $votingID, 0).One(\"id\")\n            if noteId {\n                notifications_Close(\"notific_id\", Int(noteId))\n            }\n        }\n\n        // check the decision\n        if $voting[\"flags.decision\"] == 1 {\n            warning \"Decision was taken. Voting is now not possible\"\n        }\n\n        // check start-end of voting time\n        var voting_start voting_end string\n        voting_start = DBFind(\"votings\").Where(\"id=$ and date_started < $\", $votingID, BlockTime()).One(\"id\")\n        voting_end = DBFind(\"votings\").Where(\"id=$ and date_ended > $\", $votingID, BlockTime()).One(\"id\")\n        if !voting_start {\n            warning \"Voting has not yet begun. Try again later, please\"\n        }\n        if !voting_end {\n            warning \"Voting has expired. Voting is now not possible\"\n        }\n\n        DBUpdate(\"votings_participants\", Int($participant_id), \"timestamp decision_date,decision\", $block_time, 1)\n\n        // increment count of accept\n        DBUpdate(\"votings_subject\", Int($subject[\"id\"]), \"+number_accept\", 1)\n\n        voting_UpdateDataForGraphs(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_AcceptDecision",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_CreateNew {\n    data {\n        voting_name string\n        voting_type int\n        type_participants int\n        type_decision int\n\n        volume int\n        quorum int\n\n        description string \"optional\"\n        interval string \"optional\"\n        start_date string \"optional\"\n        start_time string \"optional\"\n        end_date string \"optional\"\n        end_time string \"optional\"\n    }\n    func trimZeroTime(s string) string{\n        if Contains(s, \"T00:00:00Z\"){\n            s = s Replace(s, \"T00:00:00Z\", \"\")\n        }\n        return s\n    }\n    func dateAddTime(d, t string) string {\n        return Sprintf(\"%v %v\", trimZeroTime(d), t)\n    }\n    func isCalledFromPage() bool{\n        return $stack[0] == Sprintf(\"@%v%v\", $ecosystem_id, $this_contract)\n    }\n    func checkDatetimes(){\n        if Size($date_started) < 10 || Size($date_ended) < 10 { // invalid datetimes\n            if isCalledFromPage(){\n                var errs array\n                if Size($start_date) < 1 {\n                    errs = Append(errs, \"starting date\")\n                }\n                if Size($start_time) < 1 {\n                    errs = Append(errs, \"starting time\")\n                }\n                if Size($end_date) < 1 {\n                    errs = Append(errs, \"ending date\")\n                }\n                if Size($end_time) < 1 {\n                    errs = Append(errs, \"ending time\")\n                }\n                error Sprintf(\"Error create voting: %v not found\", Join(errs, \", \"))\n            }else{\n                $timestamped = true\n                $date_started = $time + 2 * 60\n                $interval = Int($interval)\n                if $interval == 0 {\n                    $interval = 3\n                }\n                $date_ended = $date_started + 3600 * 24 * $interval\n            }\n        }\n    }\n    conditions {\n        if $voting_type == 2 {\n            if !($original_contract == \"tokenrefund_Start\" || $original_contract == \"voting_TemplateRun\" || $original_contract == \"sysparams_StartNodeAdd\"){\n                warning Sprintf(\"The voting type 'system' is not allowed to launch from %v\", $original_contract)\n            }\n        }\n        if ($volume < 50) || ($volume > 100) {\n            warning Sprintf(\"Volume [%v] should be in the range from 50 to 100\", $volume)\n        }\n\n        if ($quorum < 5) || ($quorum > 100) {\n            warning Sprintf(\"Quorum [%v] should be in the range from 5 to 100\", $quorum)\n        }\n\n        $key = DBFind(\"keys\").Where(\"id=$\", $key_id).Row()\n        if !$key {\n            warning \"You are not a member of the ecosystem\"\n        }\n        $timestamped = false\n        $date_started = dateAddTime($start_date, $start_time)\n        $date_ended = dateAddTime($end_date, $end_time)\n        checkDatetimes()\n    }\n\n    action {\n        var voting progress flags creator map votingId int\n        voting[\"name\"] = $voting_name\n        voting[\"type\"] = $voting_type\n        voting[\"description\"] = $description\n        voting[\"type_participants\"] = $type_participants\n        voting[\"type_decision\"] = $type_decision\n        voting[\"volume\"] = $volume\n        voting[\"quorum\"] = $quorum\n\n        progress[\"number_participants\"] = \"0\"\n        progress[\"number_voters\"] = \"0\"\n        progress[\"percent_success\"] = \"0\"\n        progress[\"percent_voters\"] = \"0\"\n\n        flags[\"success\"] = \"0\"\n        flags[\"decision\"] = \"0\"\n        flags[\"full_data\"] = \"0\"\n        flags[\"notifics\"] = \"0\"\n\n        creator[\"member_id\"] = $key[\"id\"]\n        creator[\"member_name\"] = IdToAddress($key_id)\n        if $timestamped {\n            votingId = DBInsert(\"votings\", \"voting,progress,flags,creator,timestamp date_started,timestamp date_ended\", voting, progress, flags, creator, $date_started, $date_ended)\n        }else{\n            votingId = DBInsert(\"votings\", \"voting,progress,flags,creator,date_started,date_ended\", voting, progress, flags, creator, $date_started, $date_ended)\n        }\n\n        // if all members are voting participants\n        if $type_participants == 1 {\n            voting_Invite(\"votingID,var_id\", votingId, 0)\n        }\n        $result = votingId\n    }\n}",
            "Name": "voting_CreateNew",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SubjectCandidates {\n    data {\n        votingID int\n        memberID int\n    }\n    func getMemberInfo(kid int) map {\n        var res member map\n        member = DBFind(\"members\").Where(\"id=?\", kid).Row()\n        if member {\n            res[\"member_id\"] = member[\"id\"]\n            res[\"member_name\"] = member[\"member_name\"]\n            res[\"image_id\"] = member[\"image_id\"]\n        }else{\n            member = DBFind(\"keys\").Where(\"id=?\", kid).Row()\n            if member {\n                res[\"member_id\"] = member[\"id\"]\n                res[\"member_name\"] = IdToAddress(Int(member[\"id\"]))\n                res[\"image_id\"] = 0\n            }\n        }\n        return res\n    }\n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n\n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"id,date_started,optional,voting->type,flags->full_data\").Where(\"id=? and date_started > ?\", $votingID, BlockTime()).Row()\n        if !$voting {\n            warning \"Voting already started. Can not edit document\"\n        }\n\n        if $voting[\"flags.full_data\"] == 1 && $voting[\"voting.type\"] == 2 {\n            warning \"This vote is a system. Change settings not allowed\"\n        }\n\n        if $memberID == 0 {\n            $memberID = $key_id\n        }\n\n        if DBFind(\"votings_subject\").Where(\"voting_id=? and subject->member_id=?\", $votingID, $memberID).One(\"id\") {\n            warning \"This candidature for this role has already been added before\"\n        }\n\n        $member = getMemberInfo($memberID)\n        if !$member {\n            warning Sprintf(\"Key not found (%v)\", $memberID)\n        }\n    }\n\n    action {\n        DBInsert(\"votings_subject\", \"voting_id,subject\", $votingID, $member)\n\n        var optional map\n        optional = safeJsonToMap($voting[\"optional\"])\n\n        var number_candidates int\n        if optional[\"number_candidates\"]{\n            number_candidates = Int(optional[\"number_candidates\"])\n            number_candidates = number_candidates + 1\n        } else {\n            number_candidates = 1\n        }\n\n        DBUpdate(\"votings\", $votingID, \"optional->number_candidates\", number_candidates)\n    }\n}",
            "Name": "voting_SubjectCandidates",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SubjectCheckFulldata {\n    data {\n        votingID int\n    }\n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n\n    conditions {\n        $voting_map = DBFind(\"votings\").Columns(\"id,optional,voting->type,voting->type_decision,flags\").Where(\"id=?\", $votingID).Row()\n        if !$voting_map {\n            warning \"Voting is not found\"\n        }\n\n        $type_decision = $voting_map[\"voting.type_decision\"]\n        if $type_decision < 1 || $type_decision > 5 {\n            warning \"invalid type of decision\"\n        }\n\n        $subject_map = DBFind(\"votings_subject\").Where(\"voting_id=?\", $votingID).Row()\n        if !$subject_map {\n            warning \"Subject of voting is not found\"\n        }\n    }\n\n    action {\n        var flags, subject map\n        flags = safeJsonToMap($voting_map[\"flags\"])\n        if $type_decision > 2 && $type_decision <= 5 {\n            subject = safeJsonToMap($subject_map[\"subject\"])\n        }\n\n        var fullData string\n\n        if $type_decision == 1 || $type_decision == 2 {\n            var optional map\n            optional = safeJsonToMap($voting_map[\"optional\"])\n\n            if optional[\"number_candidates\"] > 0 && optional[\"role_vacancies\"] > 0 && optional[\"role_id\"] > 0 {\n                fullData = 1\n            }\n        }\n\n        if $type_decision == 3 {\n            if subject[\"text\"] != \"\" && subject[\"hash\"] != \"\" {\n                fullData = 1\n            }\n        }\n\n        if $type_decision == 4 {\n            if $voting_map[\"voting.type\"] == 1{ // personal\n                if subject[\"table\"] != \"\" && subject[\"table_id\"] != \"\" && subject[\"column\"] != \"\" && subject[\"column_value\"] != \"\" {\n                    fullData = 1\n                }\n            }\n            if $voting_map[\"voting.type\"] == 2 { // system\n                if subject[\"column\"] != \"\" && subject[\"column_value\"] != \"\" {\n                    fullData = 1\n                }\n            }\n        }\n\n        if $type_decision == 5 {\n            if subject[\"contract_accept\"] != \"\" && subject[\"contract_reject\"] != \"\" {\n                fullData = 1\n            }\n        }\n\n        if fullData == 1 {\n            DBUpdate(\"votings\", $votingID, \"flags->full_data\", fullData)\n        }\n    }\n}",
            "Name": "voting_SubjectCheckFulldata",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SubjectContract {\n    data {\n        votingID int\n        \n        contract_accept string\n        contract_accept_params string \"optional\"\n        \n        contract_reject string\n        contract_reject_params string \"optional\"\n    }\n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n    \n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"id,date_started,voting->type,flags->full_data\").Where(\"id=? and date_started > ?\", $votingID, BlockTime()).Row()\n        if !$voting {\n            warning \"Voting already started. Can not edit document\"\n        }\n        \n        if $voting[\"flags.full_data\"] == 1 && $voting[\"voting.type\"] == 2 {\n            warning \"This vote is a system. Change settings not allowed\"\n        }\n    }\n    \n    action {\n        var accept_params, reject_params map\n        accept_params = safeJsonToMap($contract_accept_params)\n        reject_params = safeJsonToMap($contract_reject_params)\n\n        var subject map\n        subject[\"contract_accept\"] = $contract_accept\n        subject[\"contract_accept_params\"] = accept_params\n        subject[\"contract_reject\"] = $contract_reject\n        subject[\"contract_reject_params\"] = reject_params\n        \n        $subject_id = DBFind(\"votings_subject\").Where(\"voting_id = $\", $votingID).One(\"id\")\n        if !$subject_id {\n            DBInsert(\"votings_subject\", \"voting_id,subject\", $votingID, subject)\n        } else {\n            DBUpdate(\"votings_subject\", Int($subject_id), \"subject\", subject)\n        }\n        \n        voting_SubjectCheckFulldata(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_SubjectContract",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SubjectDocument {\n    data {\n        votingID int\n        text_document string\n        \n        contract_accept string \"optional\"\n        contract_accept_params string \"optional\"\n        contract_reject string \"optional\"\n        contract_reject_params string \"optional\"\n    }\n    \n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n    \n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"id,date_started,flags->full_data,voting->type,optional\").Where(\"id=? and date_started > ?\", $votingID, BlockTime()).Row()\n        if !$voting {\n            warning \"Voting already started. Can not edit document\"\n        }\n        \n        if $voting[\"flags.full_data\"] == 1 && $voting[\"voting.type\"] == 2 {\n            warning \"This vote is a system. Change settings not allowed\"\n        }\n    }\n    \n    action {\n        var subject map\n        subject[\"text\"] = $text_document\n        subject[\"hash\"] = Sha256($text_document)\n        \n        $subject_id = DBFind(\"votings_subject\").Where(\"voting_id = $\", $votingID).One(\"id\")\n        if !$subject_id {\n            DBInsert(\"votings_subject\", \"voting_id,subject\", $votingID, subject)\n        } else {\n            DBUpdate(\"votings_subject\", Int($subject_id), \"subject\", subject)\n        }\n        var accept_params reject_params map\n        accept_params = safeJsonToMap($contract_accept_params)\n        reject_params = safeJsonToMap($contract_reject_params)\n\n        var optional map\n        optional = safeJsonToMap($voting[\"optional\"])\n        \n        optional[\"contract_accept\"] = $contract_accept\n        optional[\"contract_accept_params\"] = accept_params\n        optional[\"contract_reject\"] = $contract_reject\n        optional[\"contract_reject_params\"] = reject_params\n        \n        DBUpdate(\"votings\", $votingID, \"optional\", optional)\n        \n        voting_SubjectCheckFulldata(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_SubjectDocument",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SubjectFormal {\n    data {\n        votingID int\n        \n        description string \"optional\"\n        table_to_written string\n        row_id string\n        column_name string\n        written_value string\n        \n        contract_accept string \"optional\"\n        contract_accept_params string \"optional\"\n        contract_reject string \"optional\"\n        contract_reject_params string \"optional\"\n    }\n    \n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n    \n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"id,date_started,flags->full_data,voting->type,optional\").Where(\"id=? and date_started > ?\", $votingID, BlockTime()).Row()\n        if !$voting {\n            warning \"Voting already started. Can not edit document\"\n        }\n        \n        if $voting[\"flags.full_data\"] == 1 && $voting[\"voting.type\"] == 2 {\n            warning \"This vote is a system. Change settings not allowed\"\n        }\n    }\n    \n    action {\n        var subject map\n        subject[\"description\"] = $description\n        subject[\"table\"] = $table_to_written\n        subject[\"table_id\"] = $row_id\n        subject[\"column\"] = $column_name\n        subject[\"column_value\"] = $written_value\n        \n        $subject_id = DBFind(\"votings_subject\").Where(\"voting_id = $\", $votingID).One(\"id\")\n        if !$subject_id {\n            DBInsert(\"votings_subject\", \"voting_id,subject\", $votingID, subject)\n        } else {\n            DBUpdate(\"votings_subject\", Int($subject_id), \"subject\", subject)\n        }\n        \n        var accept_params reject_params map\n        accept_params = safeJsonToMap($contract_accept_params)\n        reject_params = safeJsonToMap($contract_reject_params)\n        \n        var optional map\n        optional = safeJsonToMap($voting[\"optional\"])\n        optional[\"contract_accept\"] = $contract_accept\n        optional[\"contract_accept_params\"] = accept_params\n        optional[\"contract_reject\"] = $contract_reject\n        optional[\"contract_reject_params\"] = reject_params\n        \n        DBUpdate(\"votings\", $votingID, \"optional\", optional)\n        \n        voting_SubjectCheckFulldata(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_SubjectFormal",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_SubjectSettings {\n    data {\n        votingID int\n        \n        roleID int\n        vacancies int\n        \n        contract_accept string \"optional\"\n        contract_accept_params string \"optional\"\n        contract_reject string \"optional\"\n        contract_reject_params string \"optional\"\n    }\n    func safeJsonToMap(m string) map {\n        var res map\n        if Size(m) > 0 { res = JSONToMap(m) }\n        return res\n    }\n    \n    conditions {\n        if $vacancies < 1 {\n            warning \"Number of vacancies can not be less than 1\"\n        }\n        \n        $voting = DBFind(\"votings\").Columns(\"optional,voting->type,flags->full_data\").Where(\"id=? and date_started > ?\", $votingID, BlockTime()).Row()\n        \n        if !$voting {\n            warning \"Voting already started. Can not edit document\"\n        }\n        \n        if $voting[\"flags.full_data\"] == 1 && $voting[\"voting.type\"] == 2 {\n            warning \"This vote is a system. Change settings not allowed\"\n        }\n        var role map\n        role = DBFind(\"roles\").Where(\"id=? and deleted=0\", $roleID).Row()\n        if !role {\n            warning \"Specified role not found\"\n        }\n        \n        // roles_types: 1. assigned_role, 2. elective_role, 3. system_role, 4. company_role\n        if !(role[\"role_type\"] == 2 || role[\"role_type\"] == 3) {\n            warning \"The chosen role is not elective or has been removed\"\n        }\n    }\n    \n    action {\n        var optional map\n        optional = safeJsonToMap($voting[\"optional\"])\n        \n        optional[\"contract_accept\"] = $contract_accept\n        optional[\"contract_accept_params\"] = safeJsonToMap($contract_accept_params)\n        optional[\"contract_reject\"] = $contract_reject\n        optional[\"contract_reject_params\"] = safeJsonToMap($contract_reject_params)\n        optional[\"role_id\"] = $roleID\n        optional[\"role_vacancies\"] = $vacancies\n        \n        DBUpdate(\"votings\", $votingID, \"optional\", optional)\n        \n        voting_SubjectCheckFulldata(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_SubjectSettings",
            "Type": "contracts"
        },
        {
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract voting_RejectDecision {\n    data {\n        votingID int\n    }\n    \n    conditions {\n        $voting = DBFind(\"votings\").Columns(\"voting->type_participants,voting->role_id,flags->decision,flags->notifics\").Where(\"id=$\", $votingID).Row()\n        if !$voting {\n            warning \"Voting is not found\"\n        }\n        if $voting[\"voting.type_participants\"] == 3{\n            if $voting[\"voting.role_id\"] != $role_id{\n                warning \"Incorrect role for voting\"\n            }\n        }\n\n        $participant_id = DBFind(\"votings_participants\").Where(\"voting_id=$ and member->member_id=$\", $votingID, $key_id).One(\"id\")\n        if !$participant_id {\n            warning \"You are not a participant in this voting\"\n        }\n    }\n    \n    action {\n        if $voting[\"flags.notifics\"] == 1 {\n            // close sent notifications\n            var notific_id string\n            notific_id = DBFind(\"notifications\").Where(\"recipient->member_id=$ and page_name='voting_view' and page_params->voting_id=$ and closed=0\", $key_id, $votingID).One(\"id\")\n            if notific_id {\n                notifications_Close(\"notific_id\", Int(notific_id))\n            }\n        }\n        \n        if $voting[\"flags.decision\"] == 1 {\n            warning \"Decision was taken. Voting is now not possible\"\n        }\n        var voting_start, voting_end string\n        voting_start = DBFind(\"votings\").Where(\"id=$ and date_started < $\", $votingID, BlockTime()).One(\"id\")\n        voting_end = DBFind(\"votings\").Where(\"id=$ and date_ended > $\", $votingID, BlockTime()).One(\"id\")\n        if !voting_start {\n            warning \"Voting has not yet begun. Try again later, please\"\n        }\n        if !voting_end {\n            warning \"Voting has expired. Voting is now not possible\"\n        }\n        \n        \n        DBUpdate(\"votings_participants\", Int($participant_id), \"timestamp decision_date,decision\", $block_time, -1)\n        \n        voting_UpdateDataForGraphs(\"votingID\", $votingID)\n    }\n}",
            "Name": "voting_RejectDecision",
            "Type": "contracts"
        }
    ]
}